---
title: "Python å¼‚æ­¥ç¼–ç¨‹"
description: "ä» JavaScript å¼€å‘è€…è§†è§’å­¦ä¹  Python çš„å¼‚æ­¥ç¼–ç¨‹ã€äº‹ä»¶å¾ªç¯æœºåˆ¶å’Œå¼‚æ­¥ Web å¼€å‘"
---

## 1. å¼•è¨€

### ä¸ºä»€ä¹ˆéœ€è¦å¼‚æ­¥ç¼–ç¨‹ï¼Ÿ

ä½œä¸º JavaScript å¼€å‘è€…ï¼Œä½ å·²ç»ç†Ÿæ‚‰äº† Promiseã€async/await å’Œäº‹ä»¶å¾ªç¯çš„æ¦‚å¿µã€‚Python ä¹Ÿæœ‰è‡ªå·±çš„å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹ï¼Œè™½ç„¶è¯­æ³•ç›¸ä¼¼ï¼Œä½†åº•å±‚æœºåˆ¶æœ‰æ‰€ä¸åŒã€‚

**å¼‚æ­¥ç¼–ç¨‹çš„æ ¸å¿ƒä»·å€¼**
- æé«˜ç¨‹åºæ€§èƒ½ï¼šé¿å…é˜»å¡ I/O æ“ä½œ
- æ›´å¥½çš„èµ„æºåˆ©ç”¨ï¼šå•çº¿ç¨‹å¤„ç†å¤šä¸ªå¹¶å‘ä»»åŠ¡
- å“åº”æ€§ï¼šä¿æŒç¨‹åºçš„å“åº”èƒ½åŠ›
- å¯æ‰©å±•æ€§ï¼šæ”¯æŒå¤§é‡å¹¶å‘è¿æ¥

> ğŸ’¡ **å­¦ä¹ ç­–ç•¥**ï¼šå°† Python çš„å¼‚æ­¥ç¼–ç¨‹è§†ä¸º JavaScript å¼‚æ­¥æ¨¡å‹çš„"Python ç‰ˆæœ¬"

## 2. åŒæ­¥ vs å¼‚æ­¥

### 2.1 åŸºæœ¬æ¦‚å¿µå¯¹æ¯”

<PythonEditor title="åŒæ­¥ vs å¼‚æ­¥å¯¹æ¯”" compare={true}>
```javascript !! js
// JavaScript åŒæ­¥æ“ä½œ
function syncOperation() {
    console.log("å¼€å§‹åŒæ­¥æ“ä½œ");
    // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
    const start = Date.now();
    while (Date.now() - start < 2000) {
        // é˜»å¡ 2 ç§’
    }
    console.log("åŒæ­¥æ“ä½œå®Œæˆ");
    return "åŒæ­¥ç»“æœ";
}

// JavaScript å¼‚æ­¥æ“ä½œ
async function asyncOperation() {
    console.log("å¼€å§‹å¼‚æ­¥æ“ä½œ");
    // æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œ
    await new Promise(resolve => setTimeout(resolve, 2000));
    console.log("å¼‚æ­¥æ“ä½œå®Œæˆ");
    return "å¼‚æ­¥ç»“æœ";
}

// åŒæ­¥è°ƒç”¨ï¼ˆä¼šé˜»å¡ï¼‰
console.log("è°ƒç”¨åŒæ­¥å‡½æ•°");
const syncResult = syncOperation();
console.log("åŒæ­¥ç»“æœ:", syncResult);

// å¼‚æ­¥è°ƒç”¨ï¼ˆä¸ä¼šé˜»å¡ï¼‰
console.log("è°ƒç”¨å¼‚æ­¥å‡½æ•°");
asyncOperation().then(result => {
    console.log("å¼‚æ­¥ç»“æœ:", result);
});
console.log("å¼‚æ­¥è°ƒç”¨åç«‹å³æ‰§è¡Œ");
```

```python !! py
import asyncio
import time

# Python åŒæ­¥æ“ä½œ
def sync_operation():
    """åŒæ­¥æ“ä½œ"""
    print("å¼€å§‹åŒæ­¥æ“ä½œ")
    # æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
    time.sleep(2)  # é˜»å¡ 2 ç§’
    print("åŒæ­¥æ“ä½œå®Œæˆ")
    return "åŒæ­¥ç»“æœ"

# Python å¼‚æ­¥æ“ä½œ
async def async_operation():
    """å¼‚æ­¥æ“ä½œ"""
    print("å¼€å§‹å¼‚æ­¥æ“ä½œ")
    # æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œ
    await asyncio.sleep(2)  # éé˜»å¡ç­‰å¾…
    print("å¼‚æ­¥æ“ä½œå®Œæˆ")
    return "å¼‚æ­¥ç»“æœ"

# åŒæ­¥è°ƒç”¨ï¼ˆä¼šé˜»å¡ï¼‰
print("è°ƒç”¨åŒæ­¥å‡½æ•°")
sync_result = sync_operation()
print("åŒæ­¥ç»“æœ:", sync_result)

# å¼‚æ­¥è°ƒç”¨ï¼ˆä¸ä¼šé˜»å¡ï¼‰
async def main():
    print("è°ƒç”¨å¼‚æ­¥å‡½æ•°")
    result = await async_operation()
    print("å¼‚æ­¥ç»“æœ:", result)

# è¿è¡Œå¼‚æ­¥å‡½æ•°
print("å¼‚æ­¥è°ƒç”¨åç«‹å³æ‰§è¡Œ")
asyncio.create_task(main())
```
</PythonEditor>

### 2.2 äº‹ä»¶å¾ªç¯æœºåˆ¶

<PythonEditor title="äº‹ä»¶å¾ªç¯æœºåˆ¶å¯¹æ¯”" compare={true}>
```javascript !! js
// JavaScript äº‹ä»¶å¾ªç¯
console.log("1. å¼€å§‹æ‰§è¡Œ");

setTimeout(() => {
    console.log("4. å®šæ—¶å™¨å›è°ƒ");
}, 0);

Promise.resolve().then(() => {
    console.log("3. Promise å¾®ä»»åŠ¡");
});

console.log("2. åŒæ­¥ä»£ç ç»“æŸ");

// è¾“å‡ºé¡ºåºï¼š
// 1. å¼€å§‹æ‰§è¡Œ
// 2. åŒæ­¥ä»£ç ç»“æŸ
// 3. Promise å¾®ä»»åŠ¡
// 4. å®šæ—¶å™¨å›è°ƒ
```

```python !! py
import asyncio

# Python äº‹ä»¶å¾ªç¯
async def main():
    print("1. å¼€å§‹æ‰§è¡Œ")
    
    # åˆ›å»ºä»»åŠ¡
    task1 = asyncio.create_task(asyncio.sleep(0))
    task2 = asyncio.create_task(asyncio.sleep(0))
    
    print("2. ä»»åŠ¡å·²åˆ›å»º")
    
    # ç­‰å¾…ä»»åŠ¡å®Œæˆ
    await task1
    print("3. ç¬¬ä¸€ä¸ªä»»åŠ¡å®Œæˆ")
    
    await task2
    print("4. ç¬¬äºŒä¸ªä»»åŠ¡å®Œæˆ")

# è¿è¡Œäº‹ä»¶å¾ªç¯
# åœ¨ Pyodide ç¯å¢ƒä¸­ï¼Œç›´æ¥è°ƒç”¨å¼‚æ­¥å‡½æ•°
asyncio.create_task(main())

# è¾“å‡ºé¡ºåºï¼š
# 1. å¼€å§‹æ‰§è¡Œ
# 2. ä»»åŠ¡å·²åˆ›å»º
# 3. ç¬¬ä¸€ä¸ªä»»åŠ¡å®Œæˆ
# 4. ç¬¬äºŒä¸ªä»»åŠ¡å®Œæˆ
```
</PythonEditor>

## 3. Python å¼‚æ­¥ç¼–ç¨‹åŸºç¡€

### 3.1 async/await è¯­æ³•

Python çš„ async/await è¯­æ³•ä¸ JavaScript éå¸¸ç›¸ä¼¼ï¼Œä½†æœ‰ä¸€äº›é‡è¦çš„å·®å¼‚ã€‚

<PythonEditor title="async/await è¯­æ³•å¯¹æ¯”" compare={true}>
```javascript !! js
// JavaScript async/await
async function fetchUserData(userId) {
    try {
        console.log(`å¼€å§‹è·å–ç”¨æˆ· ${userId} çš„æ•°æ®`);
        
        // æ¨¡æ‹Ÿ API è°ƒç”¨
        const response = await new Promise((resolve, reject) => {
            setTimeout(() => {
                if (userId > 0) {
                    resolve({
                        id: userId,
                        name: `ç”¨æˆ·${userId}`,
                        email: `user${userId}@example.com`
                    });
                } else {
                    reject(new Error("ç”¨æˆ·ä¸å­˜åœ¨"));
                }
            }, 1000);
        });
        
        console.log("æ•°æ®è·å–æˆåŠŸ");
        return response;
        
    } catch (error) {
        console.error("è·å–æ•°æ®å¤±è´¥:", error.message);
        throw error;
    }
}

async function processUsers() {
    console.log("å¼€å§‹å¤„ç†ç”¨æˆ·æ•°æ®");
    
    try {
        const user1 = await fetchUserData(1);
        const user2 = await fetchUserData(2);
        
        console.log("ç”¨æˆ·1:", user1);
        console.log("ç”¨æˆ·2:", user2);
        
        return [user1, user2];
        
    } catch (error) {
        console.error("å¤„ç†ç”¨æˆ·æ•°æ®å¤±è´¥:", error.message);
    }
}

// è°ƒç”¨å¼‚æ­¥å‡½æ•°
processUsers().then(users => {
    console.log("æ‰€æœ‰ç”¨æˆ·:", users);
});
```

```python !! py
import asyncio
import random

# Python async/await
async def fetch_user_data(user_id):
    """è·å–ç”¨æˆ·æ•°æ®"""
    try:
        print(f"å¼€å§‹è·å–ç”¨æˆ· {user_id} çš„æ•°æ®")
        
        # æ¨¡æ‹Ÿ API è°ƒç”¨
        await asyncio.sleep(1)  # æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ
        
        if user_id > 0:
            data = {
                "id": user_id,
                "name": f"ç”¨æˆ·{user_id}",
                "email": f"user{user_id}@example.com"
            }
            print("æ•°æ®è·å–æˆåŠŸ")
            return data
        else:
            raise ValueError("ç”¨æˆ·ä¸å­˜åœ¨")
            
    except Exception as error:
        print(f"è·å–æ•°æ®å¤±è´¥: {error}")
        raise error

async def process_users():
    """å¤„ç†ç”¨æˆ·æ•°æ®"""
    print("å¼€å§‹å¤„ç†ç”¨æˆ·æ•°æ®")
    
    try:
        # é¡ºåºæ‰§è¡Œ
        user1 = await fetch_user_data(1)
        user2 = await fetch_user_data(2)
        
        print("ç”¨æˆ·1:", user1)
        print("ç”¨æˆ·2:", user2)
        
        return [user1, user2]
        
    except Exception as error:
        print(f"å¤„ç†ç”¨æˆ·æ•°æ®å¤±è´¥: {error}")

# è¿è¡Œå¼‚æ­¥å‡½æ•°
async def main():
    users = await process_users()
    print("æ‰€æœ‰ç”¨æˆ·:", users)

# åœ¨ Pyodide ç¯å¢ƒä¸­ï¼Œç›´æ¥è°ƒç”¨å¼‚æ­¥å‡½æ•°
asyncio.create_task(main())
```
</PythonEditor>

### 3.2 å¹¶å‘æ‰§è¡Œ

Python æä¾›äº†å¤šç§æ–¹å¼æ¥å®ç°å¹¶å‘æ‰§è¡Œï¼Œç±»ä¼¼äº JavaScript çš„ Promise.all()ã€‚

<PythonEditor title="å¹¶å‘æ‰§è¡Œå¯¹æ¯”" compare={true}>
```javascript !! js
// JavaScript å¹¶å‘æ‰§è¡Œ
async function fetchUserData(userId) {
    console.log(`å¼€å§‹è·å–ç”¨æˆ· ${userId} çš„æ•°æ®`);
    // æ¨¡æ‹Ÿéšæœºå»¶è¿Ÿ
    const delay = 500 + Math.random() * 1000;
    await new Promise(resolve => setTimeout(resolve, delay));
    console.log(`å®Œæˆè·å–ç”¨æˆ· ${userId} çš„æ•°æ®`);
    return {
        id: userId,
        name: `ç”¨æˆ·${userId}`,
        email: `user${userId}@example.com`
    };
}

async function processUsersConcurrently() {
    console.log("å¼€å§‹å¹¶å‘è·å–ç”¨æˆ·æ•°æ® (Promise.all)");
    const promises = [
        fetchUserData(1),
        fetchUserData(2),
        fetchUserData(3)
    ];
    const users = await Promise.all(promises);
    console.log("æ‰€æœ‰ç”¨æˆ·æ•°æ®:", users);
    return users;
}

// ä½¿ç”¨ Promise.race() è·å–æœ€å¿«çš„ç»“æœ
async function getFastestUser() {
    console.log("\nå¼€å§‹ç«é€Ÿè·å–ç”¨æˆ·æ•°æ® (Promise.race)");
    const promises = [
        fetchUserData(1),
        fetchUserData(2),
        fetchUserData(3)
    ];
    const fastestUser = await Promise.race(promises);
    console.log("æœ€å¿«çš„ç”¨æˆ·:", fastestUser);
    return fastestUser;
}

// è°ƒç”¨å‡½æ•°
processUsersConcurrently();
getFastestUser();
```

```python !! py
import asyncio
import random

# Python å¹¶å‘æ‰§è¡Œ
async def fetch_user_data(user_id):
    """è·å–ç”¨æˆ·æ•°æ®"""
    print(f"å¼€å§‹è·å–ç”¨æˆ· {user_id} çš„æ•°æ®")
    # æ¨¡æ‹Ÿéšæœºç½‘ç»œå»¶è¿Ÿ
    delay = 0.5 + random.random()
    await asyncio.sleep(delay)
    print(f"å®Œæˆè·å–ç”¨æˆ· {user_id} çš„æ•°æ®")
    return {
        "id": user_id,
        "name": f"ç”¨æˆ·{user_id}",
        "email": f"user{user_id}@example.com"
    }

async def process_users_concurrently():
    """å¹¶å‘å¤„ç†ç”¨æˆ·æ•°æ® (ç±»ä¼¼ Promise.all)"""
    print("å¼€å§‹å¹¶å‘è·å–ç”¨æˆ·æ•°æ® (asyncio.gather)")
    tasks = [
        fetch_user_data(1),
        fetch_user_data(2),
        fetch_user_data(3)
    ]
    users = await asyncio.gather(*tasks)
    print("æ‰€æœ‰ç”¨æˆ·æ•°æ®:", users)
    return users

async def get_fastest_user():
    """è·å–æœ€å¿«çš„ç”¨æˆ·æ•°æ® (ç±»ä¼¼ Promise.race)"""
    print("\nå¼€å§‹ç«é€Ÿè·å–ç”¨æˆ·æ•°æ® (asyncio.wait)")
    tasks = [
        asyncio.create_task(fetch_user_data(1)),
        asyncio.create_task(fetch_user_data(2)),
        asyncio.create_task(fetch_user_data(3))
    ]
    
    # ç­‰å¾…ç¬¬ä¸€ä¸ªä»»åŠ¡å®Œæˆ
    done, pending = await asyncio.wait(tasks, return_when=asyncio.FIRST_COMPLETED)
    
    # è·å–å·²å®Œæˆä»»åŠ¡çš„ç»“æœ
    fastest_user = done.pop().result()
    
    # å–æ¶ˆå…¶ä»–æœªå®Œæˆçš„ä»»åŠ¡
    for task in pending:
        task.cancel()
        
    print(f"æœ€å¿«çš„ç”¨æˆ·: {fastest_user}")
    return fastest_user

# è¿è¡Œå¹¶å‘å‡½æ•°
async def main():
    await process_users_concurrently()
    await get_fastest_user()

# åœ¨ Pyodide ç¯å¢ƒä¸­ï¼Œç›´æ¥è°ƒç”¨å¼‚æ­¥å‡½æ•°
asyncio.create_task(main())
```
</PythonEditor>

### 3.3 å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨

Python çš„å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨ç±»ä¼¼äº JavaScript çš„ try-with-resources æ¨¡å¼ã€‚

<PythonEditor title="å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨" compare={true}>
```javascript !! js
// JavaScript èµ„æºç®¡ç†
class AsyncResource {
    constructor(name) {
        this.name = name;
        this.isOpen = false;
    }
    
    async open() {
        console.log(`æ‰“å¼€èµ„æº: ${this.name}`);
        this.isOpen = true;
    }
    
    async close() {
        console.log(`å…³é—­èµ„æº: ${this.name}`);
        this.isOpen = false;
    }
    
    async use() {
        if (!this.isOpen) {
            throw new Error("èµ„æºæœªæ‰“å¼€");
        }
        console.log(`ä½¿ç”¨èµ„æº: ${this.name}`);
        await new Promise(resolve => setTimeout(resolve, 1000));
    }
}

// æ‰‹åŠ¨èµ„æºç®¡ç†
async function useResource() {
    const resource = new AsyncResource("æ•°æ®åº“è¿æ¥");
    
    try {
        await resource.open();
        await resource.use();
    } finally {
        await resource.close();
    }
}

// ä½¿ç”¨èµ„æº
useResource();
```

```python !! py
import asyncio
from contextlib import asynccontextmanager

# Python å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨
class AsyncResource:
    """å¼‚æ­¥èµ„æºç±»"""
    
    def __init__(self, name):
        self.name = name
        self.is_open = False
    
    async def __aenter__(self):
        """è¿›å…¥ä¸Šä¸‹æ–‡"""
        print(f"æ‰“å¼€èµ„æº: {self.name}")
        self.is_open = True
        return self
    
    async def __aexit__(self, exc_type, exc_val, exc_tb):
        """é€€å‡ºä¸Šä¸‹æ–‡"""
        print(f"å…³é—­èµ„æº: {self.name}")
        self.is_open = False
    
    async def use(self):
        """ä½¿ç”¨èµ„æº"""
        if not self.is_open:
            raise RuntimeError("èµ„æºæœªæ‰“å¼€")
        print(f"ä½¿ç”¨èµ„æº: {self.name}")
        await asyncio.sleep(1)

# ä½¿ç”¨å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨
async def use_resource():
    """ä½¿ç”¨å¼‚æ­¥èµ„æº"""
    async with AsyncResource("æ•°æ®åº“è¿æ¥") as resource:
        await resource.use()

# ä½¿ç”¨è£…é¥°å™¨åˆ›å»ºå¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨
@asynccontextmanager
async def managed_resource(name):
    """ç®¡ç†çš„èµ„æºä¸Šä¸‹æ–‡ç®¡ç†å™¨"""
    print(f"æ‰“å¼€èµ„æº: {name}")
    try:
        yield name
    finally:
        print(f"å…³é—­èµ„æº: {name}")

async def use_managed_resource():
    """ä½¿ç”¨ç®¡ç†çš„èµ„æº"""
    async with managed_resource("æ–‡ä»¶è¿æ¥") as resource:
        print(f"ä½¿ç”¨èµ„æº: {resource}")
        await asyncio.sleep(1)

# è¿è¡Œç¤ºä¾‹
async def main():
    await use_resource()
    await use_managed_resource()

# åœ¨ Pyodide ç¯å¢ƒä¸­ï¼Œç›´æ¥è°ƒç”¨å¼‚æ­¥å‡½æ•°
asyncio.create_task(main())
```
</PythonEditor>


### 3.4 å¸¸è§é™·é˜±ï¼šå¼‚æ­¥å‡½æ•°ä¸­çš„é˜»å¡ä»£ç 

åœ¨å¼‚æ­¥å‡½æ•°ä¸­ï¼Œç»å¯¹ä¸èƒ½è°ƒç”¨é˜»å¡ï¼ˆåŒæ­¥ï¼‰çš„ I/O æ“ä½œï¼Œå¦åˆ™ä¼šé˜»å¡æ•´ä¸ªäº‹ä»¶å¾ªç¯ï¼Œå¯¼è‡´æ‰€æœ‰å¹¶å‘ä»»åŠ¡åœæ»ã€‚

**é”™è¯¯ç¤ºä¾‹**
```python
import time
import requests  # åŒæ­¥ HTTP åº“

async def bad_async_function():
    # âŒ é”™è¯¯ï¼šè¿™ä¼šé˜»å¡æ•´ä¸ªäº‹ä»¶å¾ªç¯ï¼
    time.sleep(5)
    # âŒ é”™è¯¯ï¼šè¿™ä¹Ÿä¼šé˜»å¡ï¼
    requests.get("https://example.com")
```

**æ­£ç¡®åšæ³•**
```python
import asyncio
import httpx  # å¼‚æ­¥ HTTP åº“

async def good_async_function():
    # âœ… æ­£ç¡®ï¼šéé˜»å¡ç­‰å¾…
    await asyncio.sleep(5)
    
    # âœ… æ­£ç¡®ï¼šä½¿ç”¨å¼‚æ­¥åº“
    async with httpx.AsyncClient() as client:
        await client.get("https://example.com")
```

### 3.5 è¿è¡Œå¼‚æ­¥ç¨‹åº

åœ¨ä¸åŒçš„ç¯å¢ƒä¸­ï¼Œè¿è¡Œå¼‚æ­¥ä»£ç çš„æ–¹å¼ç•¥æœ‰ä¸åŒã€‚

**1. æ ‡å‡† Python è„šæœ¬**
ä½¿ç”¨ `asyncio.run()` ä½œä¸ºå…¥å£ç‚¹ã€‚

```python
import asyncio

async def main():
    print("Hello")
    await asyncio.sleep(1)
    print("World")

if __name__ == "__main__":
    # è‡ªåŠ¨åˆ›å»ºå¹¶ç®¡ç†äº‹ä»¶å¾ªç¯
    asyncio.run(main())
```

**2. Jupyter Notebook / Pyodide (æœ¬æ•™ç¨‹ç¯å¢ƒ)**
è¿™äº›ç¯å¢ƒé€šå¸¸å·²ç»æœ‰ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„äº‹ä»¶å¾ªç¯ï¼Œå› æ­¤ä¸èƒ½ä½¿ç”¨ `asyncio.run()`ã€‚
- ç›´æ¥ `await async_function()` (å¦‚æœåœ¨æ”¯æŒé¡¶å±‚ await çš„ç¯å¢ƒä¸­)
- æˆ–è€… `asyncio.create_task(async_function())` (åå°è¿è¡Œ)

## 4. å¼‚æ­¥ Web å¼€å‘


### 4.1 FastAPI åŸºç¡€

FastAPI æ˜¯ Python çš„ç°ä»£å¼‚æ­¥ Web æ¡†æ¶ï¼Œç±»ä¼¼äº JavaScript çš„ Express.jsã€‚

<PythonEditor title="FastAPI vs Express.js å¯¹æ¯”" compare={true}>
```javascript !! js
// Express.js æœåŠ¡å™¨
const express = require('express');
const app = express();
const port = 3000;

// ä¸­é—´ä»¶
app.use(express.json());

// è·¯ç”±
app.get('/', (req, res) => {
    res.json({ message: 'Hello World!' });
});

app.get('/users/:id', async (req, res) => {
    try {
        const userId = parseInt(req.params.id);
        const user = await fetchUserData(userId);
        res.json(user);
    } catch (error) {
        res.status(404).json({ error: error.message });
    }
});

app.post('/users', async (req, res) => {
    try {
        const userData = req.body;
        const newUser = await createUser(userData);
        res.status(201).json(newUser);
    } catch (error) {
        res.status(400).json({ error: error.message });
    }
});

// å¯åŠ¨æœåŠ¡å™¨
app.listen(port, () => {
    console.log(`æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:${port}`);
});

// æ¨¡æ‹Ÿå¼‚æ­¥å‡½æ•°
async function fetchUserData(userId) {
    await new Promise(resolve => setTimeout(resolve, 100));
    return { id: userId, name: `ç”¨æˆ·${userId}` };
}

async function createUser(userData) {
    await new Promise(resolve => setTimeout(resolve, 100));
    return { id: Date.now(), ...userData };
}
```

```python !! py
# FastAPI æœåŠ¡å™¨
from fastapi import FastAPI, HTTPException
from pydantic import BaseModel
from typing import Optional
import uvicorn

app = FastAPI(title="ç”¨æˆ· API", version="1.0.0")

# æ•°æ®æ¨¡å‹
class User(BaseModel):
    name: str
    email: str
    age: Optional[int] = None

class UserResponse(BaseModel):
    id: int
    name: str
    email: str
    age: Optional[int] = None

# è·¯ç”±
@app.get("/")
async def root():
    """æ ¹è·¯å¾„"""
    return {"message": "Hello World!"}

@app.get("/users/{user_id}", response_model=UserResponse)
async def get_user(user_id: int):
    """è·å–ç”¨æˆ·"""
    try:
        user = await fetch_user_data(user_id)
        return user
    except ValueError as error:
        raise HTTPException(status_code=404, detail=str(error))

@app.post("/users", response_model=UserResponse, status_code=201)
async def create_user(user: User):
    """åˆ›å»ºç”¨æˆ·"""
    try:
        new_user = await create_user_data(user)
        return new_user
    except ValueError as error:
        raise HTTPException(status_code=400, detail=str(error))

# æ¨¡æ‹Ÿå¼‚æ­¥å‡½æ•°
async def fetch_user_data(user_id: int) -> UserResponse:
    """è·å–ç”¨æˆ·æ•°æ®"""
    await asyncio.sleep(0.1)  # æ¨¡æ‹Ÿæ•°æ®åº“æŸ¥è¯¢
    if user_id <= 0:
        raise ValueError("ç”¨æˆ·ä¸å­˜åœ¨")
    return UserResponse(
        id=user_id,
        name=f"ç”¨æˆ·{user_id}",
        email=f"user{user_id}@example.com",
        age=25
    )

async def create_user_data(user: User) -> UserResponse:
    """åˆ›å»ºç”¨æˆ·æ•°æ®"""
    await asyncio.sleep(0.1)  # æ¨¡æ‹Ÿæ•°æ®åº“æ’å…¥
    return UserResponse(
        id=1,  # å®é™…åº”ç”¨ä¸­åº”è¯¥æ˜¯æ•°æ®åº“ç”Ÿæˆçš„ ID
        name=user.name,
        email=user.email,
        age=user.age
    )

# å¯åŠ¨æœåŠ¡å™¨
if __name__ == "__main__":
    uvicorn.run(app, host="0.0.0.0", port=8000)
```
</PythonEditor>

### 4.2 å¼‚æ­¥æ•°æ®åº“æ“ä½œ

<PythonEditor title="å¼‚æ­¥æ•°æ®åº“æ“ä½œ" compare={true}>
```javascript !! js
// JavaScript å¼‚æ­¥æ•°æ®åº“æ“ä½œ
const { Pool } = require('pg');

class DatabaseService {
    constructor() {
        this.pool = new Pool({
            host: 'localhost',
            database: 'testdb',
            user: 'username',
            password: 'password',
            port: 5432,
        });
    }
    
    async getUsers() {
        const client = await this.pool.connect();
        try {
            const result = await client.query('SELECT * FROM users');
            return result.rows;
        } finally {
            client.release();
        }
    }
    
    async getUserById(id) {
        const client = await this.pool.connect();
        try {
            const result = await client.query(
                'SELECT * FROM users WHERE id = $1',
                [id]
            );
            return result.rows[0];
        } finally {
            client.release();
        }
    }
    
    async createUser(userData) {
        const client = await this.pool.connect();
        try {
            const result = await client.query(
                'INSERT INTO users (name, email) VALUES ($1, $2) RETURNING *',
                [userData.name, userData.email]
            );
            return result.rows[0];
        } finally {
            client.release();
        }
    }
}

// ä½¿ç”¨æ•°æ®åº“æœåŠ¡
const dbService = new DatabaseService();

async function handleGetUsers(req, res) {
    try {
        const users = await dbService.getUsers();
        res.json(users);
    } catch (error) {
        res.status(500).json({ error: error.message });
    }
}
```

```python !! py
# Python å¼‚æ­¥æ•°æ®åº“æ“ä½œ
import asyncpg
from typing import List, Optional
from pydantic import BaseModel

class User(BaseModel):
    id: Optional[int] = None
    name: str
    email: str

class DatabaseService:
    """æ•°æ®åº“æœåŠ¡ç±»"""
    
    def __init__(self):
        self.pool = None
    
    async def connect(self):
        """è¿æ¥æ•°æ®åº“"""
        self.pool = await asyncpg.create_pool(
            host='localhost',
            database='testdb',
            user='username',
            password='password',
            port=5432
        )
    
    async def close(self):
        """å…³é—­æ•°æ®åº“è¿æ¥"""
        if self.pool:
            await self.pool.close()
    
    async def get_users(self) -> List[User]:
        """è·å–æ‰€æœ‰ç”¨æˆ·"""
        async with self.pool.acquire() as conn:
            rows = await conn.fetch('SELECT * FROM users')
            return [User(**dict(row)) for row in rows]
    
    async def get_user_by_id(self, user_id: int) -> Optional[User]:
        """æ ¹æ® ID è·å–ç”¨æˆ·"""
        async with self.pool.acquire() as conn:
            row = await conn.fetchrow(
                'SELECT * FROM users WHERE id = $1',
                user_id
            )
            return User(**dict(row)) if row else None
    
    async def create_user(self, user: User) -> User:
        """åˆ›å»ºç”¨æˆ·"""
        async with self.pool.acquire() as conn:
            row = await conn.fetchrow(
                'INSERT INTO users (name, email) VALUES ($1, $2) RETURNING *',
                user.name, user.email
            )
            return User(**dict(row))

# ä½¿ç”¨æ•°æ®åº“æœåŠ¡
db_service = DatabaseService()

async def handle_get_users():
    """å¤„ç†è·å–ç”¨æˆ·è¯·æ±‚"""
    try:
        users = await db_service.get_users()
        return users
    except Exception as error:
        raise HTTPException(status_code=500, detail=str(error))

# åœ¨ FastAPI ä¸­ä½¿ç”¨
@app.get("/users", response_model=List[User])
async def get_users():
    """è·å–æ‰€æœ‰ç”¨æˆ·"""
    return await handle_get_users()

@app.get("/users/{user_id}", response_model=User)
async def get_user(user_id: int):
    """è·å–æŒ‡å®šç”¨æˆ·"""
    user = await db_service.get_user_by_id(user_id)
    if not user:
        raise HTTPException(status_code=404, detail="ç”¨æˆ·ä¸å­˜åœ¨")
    return user

@app.post("/users", response_model=User, status_code=201)
async def create_user(user: User):
    """åˆ›å»ºç”¨æˆ·"""
    return await db_service.create_user(user)
```
</PythonEditor>

## 5. å¼‚æ­¥è¿­ä»£å’Œç”Ÿæˆå™¨

### 5.1 å¼‚æ­¥è¿­ä»£å™¨

<PythonEditor title="å¼‚æ­¥è¿­ä»£å™¨å¯¹æ¯”" compare={true}>
```javascript !! js
// JavaScript å¼‚æ­¥è¿­ä»£å™¨
class AsyncDataStream {
    constructor(data) {
        this.data = data;
        this.index = 0;
    }
    
    async *[Symbol.asyncIterator]() {
        for (const item of this.data) {
            // æ¨¡æ‹Ÿå¼‚æ­¥å¤„ç†
            await new Promise(resolve => setTimeout(resolve, 100));
            yield item;
        }
    }
}

// ä½¿ç”¨å¼‚æ­¥è¿­ä»£å™¨
async function processDataStream() {
    const stream = new AsyncDataStream([1, 2, 3, 4, 5]);
    
    for await (const item of stream) {
        console.log(`å¤„ç†æ•°æ®: ${item}`);
    }
}

// å¼‚æ­¥ç”Ÿæˆå™¨å‡½æ•°
async function* asyncGenerator() {
    for (let i = 0; i < 5; i++) {
        await new Promise(resolve => setTimeout(resolve, 100));
        yield i;
    }
}

async function useAsyncGenerator() {
    for await (const value of asyncGenerator()) {
        console.log(`ç”Ÿæˆçš„å€¼: ${value}`);
    }
}

// è°ƒç”¨å‡½æ•°
processDataStream();
useAsyncGenerator();
```

```python !! py
import asyncio

# Python å¼‚æ­¥è¿­ä»£å™¨
class AsyncDataStream:
    """å¼‚æ­¥æ•°æ®æµ"""
    
    def __init__(self, data):
        self.data = data
        self.index = 0
    
    def __aiter__(self):
        return self
    
    async def __anext__(self):
        if self.index >= len(self.data):
            raise StopAsyncIteration
        
        # æ¨¡æ‹Ÿå¼‚æ­¥å¤„ç†
        await asyncio.sleep(0.1)
        item = self.data[self.index]
        self.index += 1
        return item

# ä½¿ç”¨å¼‚æ­¥è¿­ä»£å™¨
async def process_data_stream():
    """å¤„ç†å¼‚æ­¥æ•°æ®æµ"""
    stream = AsyncDataStream([1, 2, 3, 4, 5])
    
    async for item in stream:
        print(f"å¤„ç†æ•°æ®: {item}")

# å¼‚æ­¥ç”Ÿæˆå™¨å‡½æ•°
async def async_generator():
    """å¼‚æ­¥ç”Ÿæˆå™¨"""
    for i in range(5):
        await asyncio.sleep(0.1)
        yield i

async def use_async_generator():
    """ä½¿ç”¨å¼‚æ­¥ç”Ÿæˆå™¨"""
    async for value in async_generator():
        print(f"ç”Ÿæˆçš„å€¼: {value}")

# è¿è¡Œç¤ºä¾‹
async def main():
    await process_data_stream()
    await use_async_generator()

# åœ¨ Pyodide ç¯å¢ƒä¸­ï¼Œç›´æ¥è°ƒç”¨å¼‚æ­¥å‡½æ•°
asyncio.create_task(main())
```
</PythonEditor>

### 5.2 å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨ä¸è¿­ä»£å™¨ç»“åˆ

<PythonEditor title="å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨ä¸è¿­ä»£å™¨" compare={true}>
```javascript !! js
// JavaScript å¼‚æ­¥èµ„æºè¿­ä»£å™¨
class AsyncFileReader {
    constructor(filename) {
        this.filename = filename;
        this.fileHandle = null;
    }
    
    async open() {
        this.fileHandle = await open(this.filename, 'r');
    }
    
    async close() {
        if (this.fileHandle) {
            await this.fileHandle.close();
        }
    }
    
    async *readLines() {
        if (!this.fileHandle) {
            throw new Error('æ–‡ä»¶æœªæ‰“å¼€');
        }
        
        for await (const line of this.fileHandle.readLines()) {
            yield line.trim();
        }
    }
}

// ä½¿ç”¨å¼‚æ­¥æ–‡ä»¶è¯»å–å™¨
async function processFile(filename) {
    const reader = new AsyncFileReader(filename);
    
    try {
        await reader.open();
        
        for await (const line of reader.readLines()) {
            if (line) {
                console.log(`å¤„ç†è¡Œ: ${line}`);
            }
        }
    } finally {
        await reader.close();
    }
}
```

```python !! py
import asyncio
import aiofiles

# Python å¼‚æ­¥æ–‡ä»¶è¯»å–å™¨
class AsyncFileReader:
    """å¼‚æ­¥æ–‡ä»¶è¯»å–å™¨"""
    
    def __init__(self, filename):
        self.filename = filename
        self.file = None
    
    async def __aenter__(self):
        """è¿›å…¥ä¸Šä¸‹æ–‡"""
        self.file = await aiofiles.open(self.filename, mode='r')
        return self
    
    async def __aexit__(self, exc_type, exc_val, exc_tb):
        """é€€å‡ºä¸Šä¸‹æ–‡"""
        if self.file:
            await self.file.close()
    
    async def read_lines(self):
        """è¯»å–æ–‡ä»¶è¡Œ"""
        async for line in self.file:
            yield line.strip()

# ä½¿ç”¨å¼‚æ­¥æ–‡ä»¶è¯»å–å™¨
async def process_file(filename):
    """å¤„ç†æ–‡ä»¶"""
    async with AsyncFileReader(filename) as reader:
        async for line in reader.read_lines():
            if line:
                print(f"å¤„ç†è¡Œ: {line}")

# åˆ›å»ºç¤ºä¾‹æ–‡ä»¶
async def create_sample_file():
    """åˆ›å»ºç¤ºä¾‹æ–‡ä»¶"""
    async with aiofiles.open('sample.txt', mode='w') as f:
        await f.write("ç¬¬ä¸€è¡Œ\n")
        await f.write("ç¬¬äºŒè¡Œ\n")
        await f.write("ç¬¬ä¸‰è¡Œ\n")

# è¿è¡Œç¤ºä¾‹
async def main():
    await create_sample_file()
    await process_file('sample.txt')

# åœ¨ Pyodide ç¯å¢ƒä¸­ï¼Œç›´æ¥è°ƒç”¨å¼‚æ­¥å‡½æ•°
asyncio.create_task(main())
```
</PythonEditor>

## 6. å®é™…é¡¹ç›®ç¤ºä¾‹

### 6.1 å¼‚æ­¥ Web çˆ¬è™«

<PythonEditor title="å¼‚æ­¥ Web çˆ¬è™«ç¤ºä¾‹" compare={true}>
```javascript !! js
// JavaScript å¼‚æ­¥çˆ¬è™«
const axios = require('axios');
const cheerio = require('cheerio');

class AsyncWebCrawler {
    constructor() {
        this.visited = new Set();
        this.results = [];
    }
    
    async crawlPage(url) {
        if (this.visited.has(url)) {
            return;
        }
        
        this.visited.add(url);
        console.log(`çˆ¬å–é¡µé¢: ${url}`);
        
        try {
            const response = await axios.get(url);
            const $ = cheerio.load(response.data);
            
            // æå–æ ‡é¢˜
            const title = $('title').text();
            const links = $('a').map((i, el) => $(el).attr('href')).get();
            
            this.results.push({
                url,
                title,
                links: links.slice(0, 5) // é™åˆ¶é“¾æ¥æ•°é‡
            });
            
            console.log(`é¡µé¢æ ‡é¢˜: ${title}`);
            
        } catch (error) {
            console.error(`çˆ¬å–å¤±è´¥: ${url}`, error.message);
        }
    }
    
    async crawlMultiplePages(urls) {
        const promises = urls.map(url => this.crawlPage(url));
        await Promise.all(promises);
        
        return this.results;
    }
}

// ä½¿ç”¨çˆ¬è™«
async function main() {
    const crawler = new AsyncWebCrawler();
    const urls = [
        'https://example.com',
        'https://httpbin.org/get',
        'https://jsonplaceholder.typicode.com/posts/1'
    ];
    
    const results = await crawler.crawlMultiplePages(urls);
    console.log('çˆ¬å–ç»“æœ:', results);
}

// main();
```

```python !! py
import asyncio
import aiohttp
from bs4 import BeautifulSoup
from typing import List, Dict, Set
import time

class AsyncWebCrawler:
    """å¼‚æ­¥ Web çˆ¬è™«"""
    
    def __init__(self):
        self.visited: Set[str] = set()
        self.results: List[Dict] = []
    
    async def crawl_page(self, session: aiohttp.ClientSession, url: str):
        """çˆ¬å–å•ä¸ªé¡µé¢"""
        if url in self.visited:
            return
        
        self.visited.add(url)
        print(f"çˆ¬å–é¡µé¢: {url}")
        
        try:
            async with session.get(url) as response:
                if response.status == 200:
                    html = await response.text()
                    soup = BeautifulSoup(html, 'html.parser')
                    
                    # æå–æ ‡é¢˜
                    title = soup.title.string if soup.title else "æ— æ ‡é¢˜"
                    links = [a.get('href') for a in soup.find_all('a', href=True)]
                    
                    self.results.append({
                        'url': url,
                        'title': title,
                        'links': links[:5]  # é™åˆ¶é“¾æ¥æ•°é‡
                    })
                    
                    print(f"é¡µé¢æ ‡é¢˜: {title}")
                else:
                    print(f"HTTP é”™è¯¯: {response.status}")
                    
        except Exception as error:
            print(f"çˆ¬å–å¤±è´¥: {url} - {error}")
    
    async def crawl_multiple_pages(self, urls: List[str]):
        """å¹¶å‘çˆ¬å–å¤šä¸ªé¡µé¢"""
        async with aiohttp.ClientSession() as session:
            tasks = [
                self.crawl_page(session, url) 
                for url in urls
            ]
            await asyncio.gather(*tasks)
        
        return self.results

# ä½¿ç”¨çˆ¬è™«
async def main():
    crawler = AsyncWebCrawler()
    urls = [
        'https://httpbin.org/get',
        'https://jsonplaceholder.typicode.com/posts/1',
        'https://api.github.com/users/octocat'
    ]
    
    start_time = time.time()
    results = await crawler.crawl_multiple_pages(urls)
    end_time = time.time()
    
    print(f"çˆ¬å–å®Œæˆï¼Œè€—æ—¶: {end_time - start_time:.2f} ç§’")
    print("çˆ¬å–ç»“æœ:", results)

# è¿è¡Œçˆ¬è™«
# åœ¨ Pyodide ç¯å¢ƒä¸­ï¼Œç›´æ¥è°ƒç”¨å¼‚æ­¥å‡½æ•°
asyncio.create_task(main())
```
</PythonEditor>

### 6.2 å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—

<PythonEditor title="å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—ç¤ºä¾‹" compare={true}>
```javascript !! js
// JavaScript å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—
class AsyncTaskQueue {
    constructor(concurrency = 3) {
        this.concurrency = concurrency;
        this.running = 0;
        this.queue = [];
    }
    
    async add(task) {
        return new Promise((resolve, reject) => {
            this.queue.push({
                task,
                resolve,
                reject
            });
            this.process();
        });
    }
    
    async process() {
        if (this.running >= this.concurrency || this.queue.length === 0) {
            return;
        }
        
        this.running++;
        const { task, resolve, reject } = this.queue.shift();
        
        try {
            const result = await task();
            resolve(result);
        } catch (error) {
            reject(error);
        } finally {
            this.running--;
            this.process();
        }
    }
    
    async waitForAll() {
        while (this.queue.length > 0 || this.running > 0) {
            await new Promise(resolve => setTimeout(resolve, 100));
        }
    }
}

// ä½¿ç”¨ä»»åŠ¡é˜Ÿåˆ—
async function processTask(id) {
    console.log(`å¼€å§‹å¤„ç†ä»»åŠ¡ ${id}`);
    await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 2000));
    console.log(`å®Œæˆå¤„ç†ä»»åŠ¡ ${id}`);
    return `ä»»åŠ¡ ${id} çš„ç»“æœ`;
}

async function main() {
    const queue = new AsyncTaskQueue(2);
    
    // æ·»åŠ ä»»åŠ¡
    const promises = [];
    for (let i = 1; i <= 5; i++) {
        promises.push(queue.add(() => processTask(i)));
    }
    
    // ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ
    await queue.waitForAll();
    const results = await Promise.all(promises);
    
    console.log('æ‰€æœ‰ä»»åŠ¡å®Œæˆ:', results);
}

// main();
```

```python !! py
import asyncio
import random
from typing import List, Callable, Any
from dataclasses import dataclass

@dataclass
class Task:
    """ä»»åŠ¡ç±»"""
    func: Callable
    args: tuple = ()
    kwargs: dict = None
    future: asyncio.Future = None
    
    def __post_init__(self):
        if self.kwargs is None:
            self.kwargs = {}
        if self.future is None:
            self.future = asyncio.Future()

class AsyncTaskQueue:
    """å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—"""
    
    def __init__(self, concurrency: int = 3):
        self.concurrency = concurrency
        self.running = 0
        self.queue: List[Task] = []
        self.semaphore = asyncio.Semaphore(concurrency)
    
    async def add(self, func: Callable, *args, **kwargs) -> asyncio.Future:
        """æ·»åŠ ä»»åŠ¡åˆ°é˜Ÿåˆ—"""
        task = Task(func, args, kwargs)
        self.queue.append(task)
        asyncio.create_task(self._process_queue())
        return task.future
    
    async def _process_queue(self):
        """å¤„ç†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡"""
        if not self.queue or self.running >= self.concurrency:
            return
        
        self.running += 1
        task = self.queue.pop(0)
        
        try:
            async with self.semaphore:
                result = await task.func(*task.args, **task.kwargs)
                task.future.set_result(result)
        except Exception as error:
            task.future.set_exception(error)
        finally:
            self.running -= 1
            if self.queue:
                asyncio.create_task(self._process_queue())
    
    async def wait_for_all(self):
        """ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ"""
        while self.queue or self.running > 0:
            await asyncio.sleep(0.1)

# ä½¿ç”¨ä»»åŠ¡é˜Ÿåˆ—
async def process_task(task_id: int) -> str:
    """å¤„ç†ä»»åŠ¡"""
    print(f"å¼€å§‹å¤„ç†ä»»åŠ¡ {task_id}")
    await asyncio.sleep(1 + random.random() * 2)
    print(f"å®Œæˆå¤„ç†ä»»åŠ¡ {task_id}")
    return f"ä»»åŠ¡ {task_id} çš„ç»“æœ"

async def main():
    queue = AsyncTaskQueue(2)
    
    # æ·»åŠ ä»»åŠ¡
    futures = []
    for i in range(1, 6):
        future = await queue.add(process_task, i)
        futures.append(future)
    
    # ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ
    await queue.wait_for_all()
    results = await asyncio.gather(*futures)
    
    print("æ‰€æœ‰ä»»åŠ¡å®Œæˆ:", results)

asyncio.create_task(main())
```
</PythonEditor>

## 7. ç»ƒä¹ é¢˜

### ç»ƒä¹  1ï¼šå¼‚æ­¥æ•°æ®å¤„ç†

<PythonEditor title="ç»ƒä¹ é¢˜ 1ï¼šå¼‚æ­¥æ•°æ®å¤„ç†" compare={true}>
```javascript !! js
// å¼‚æ­¥æ•°æ®å¤„ç†ç»ƒä¹ 
async function processData(data) {
    // æ¨¡æ‹Ÿæ•°æ®å¤„ç†
    await new Promise(resolve => setTimeout(resolve, 100));
    return data.map(item => item * 2);
}

async function filterData(data) {
    // æ¨¡æ‹Ÿæ•°æ®è¿‡æ»¤
    await new Promise(resolve => setTimeout(resolve, 50));
    return data.filter(item => item > 10);
}

async function aggregateData(data) {
    // æ¨¡æ‹Ÿæ•°æ®èšåˆ
    await new Promise(resolve => setTimeout(resolve, 75));
    return data.reduce((sum, item) => sum + item, 0);
}

async function processDataPipeline() {
    const rawData = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];
    
    console.log("åŸå§‹æ•°æ®:", rawData);
    
    // é¡ºåºå¤„ç†
    const processed = await processData(rawData);
    console.log("å¤„ç†åæ•°æ®:", processed);
    
    const filtered = await filterData(processed);
    console.log("è¿‡æ»¤åæ•°æ®:", filtered);
    
    const result = await aggregateData(filtered);
    console.log("æœ€ç»ˆç»“æœ:", result);
    
    return result;
}

// å¹¶å‘å¤„ç†ç‰ˆæœ¬
async function processDataConcurrently() {
    const rawData = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];
    
    console.log("åŸå§‹æ•°æ®:", rawData);
    
    // å¹¶å‘å¤„ç†
    const [processed, filtered, aggregated] = await Promise.all([
        processData(rawData),
        filterData(rawData),
        aggregateData(rawData)
    ]);
    
    console.log("å¹¶å‘å¤„ç†ç»“æœ:", { processed, filtered, aggregated });
    return { processed, filtered, aggregated };
}

// è¿è¡Œç»ƒä¹ 
processDataPipeline();
processDataConcurrently();
```

```python !! py
import asyncio
from typing import List

# å¼‚æ­¥æ•°æ®å¤„ç†ç»ƒä¹ 
async def process_data(data: List[int]) -> List[int]:
    """å¤„ç†æ•°æ®"""
    await asyncio.sleep(0.1)  # æ¨¡æ‹Ÿå¤„ç†æ—¶é—´
    return [item * 2 for item in data]

async def filter_data(data: List[int]) -> List[int]:
    """è¿‡æ»¤æ•°æ®"""
    await asyncio.sleep(0.05)  # æ¨¡æ‹Ÿè¿‡æ»¤æ—¶é—´
    return [item for item in data if item > 10]

async def aggregate_data(data: List[int]) -> int:
    """èšåˆæ•°æ®"""
    await asyncio.sleep(0.075)  # æ¨¡æ‹Ÿèšåˆæ—¶é—´
    return sum(data)

async def process_data_pipeline():
    """æ•°æ®å¤„ç†ç®¡é“ï¼ˆé¡ºåºå¤„ç†ï¼‰"""
    raw_data = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
    
    print("åŸå§‹æ•°æ®:", raw_data)
    
    # é¡ºåºå¤„ç†
    processed = await process_data(raw_data)
    print("å¤„ç†åæ•°æ®:", processed)
    
    filtered = await filter_data(processed)
    print("è¿‡æ»¤åæ•°æ®:", filtered)
    
    result = await aggregate_data(filtered)
    print("æœ€ç»ˆç»“æœ:", result)
    
    return result

async def process_data_concurrently():
    """å¹¶å‘æ•°æ®å¤„ç†"""
    raw_data = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
    
    print("åŸå§‹æ•°æ®:", raw_data)
    
    # å¹¶å‘å¤„ç†
    processed, filtered, aggregated = await asyncio.gather(
        process_data(raw_data),
        filter_data(raw_data),
        aggregate_data(raw_data)
    )
    
    print("å¹¶å‘å¤„ç†ç»“æœ:", {
        "processed": processed,
        "filtered": filtered,
        "aggregated": aggregated
    })
    
    return {
        "processed": processed,
        "filtered": filtered,
        "aggregated": aggregated
    }

# è¿è¡Œç»ƒä¹ 
async def main():
    print("=== é¡ºåºå¤„ç† ===")
    await process_data_pipeline()
    
    print("\n=== å¹¶å‘å¤„ç† ===")
    await process_data_concurrently()

asyncio.create_task(main())
```
</PythonEditor>

### ç»ƒä¹  2ï¼šå¼‚æ­¥ API å®¢æˆ·ç«¯

<PythonEditor title="ç»ƒä¹ é¢˜ 2ï¼šå¼‚æ­¥ API å®¢æˆ·ç«¯" compare={true}>
```javascript !! js
// å¼‚æ­¥ API å®¢æˆ·ç«¯ç»ƒä¹ 
class AsyncAPIClient {
    constructor(baseURL) {
        this.baseURL = baseURL;
    }
    
    async get(endpoint) {
        const response = await fetch(`${this.baseURL}${endpoint}`);
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        return response.json();
    }
    
    async post(endpoint, data) {
        const response = await fetch(`${this.baseURL}${endpoint}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        });
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        return response.json();
    }
    
    async batchGet(endpoints) {
        const promises = endpoints.map(endpoint => this.get(endpoint));
        return Promise.all(promises);
    }
}

// ä½¿ç”¨ API å®¢æˆ·ç«¯
async function testAPIClient() {
    const client = new AsyncAPIClient('https://jsonplaceholder.typicode.com');
    
    try {
        // å•ä¸ªè¯·æ±‚
        const user = await client.get('/users/1');
        console.log('ç”¨æˆ·ä¿¡æ¯:', user);
        
        // æ‰¹é‡è¯·æ±‚
        const [posts, comments, albums] = await client.batchGet([
            '/posts/1',
            '/comments/1',
            '/albums/1'
        ]);
        
        console.log('æ‰¹é‡è¯·æ±‚ç»“æœ:', { posts, comments, albums });
        
        // POST è¯·æ±‚
        const newPost = await client.post('/posts', {
            title: 'æµ‹è¯•æ–‡ç« ',
            body: 'è¿™æ˜¯æµ‹è¯•å†…å®¹',
            userId: 1
        });
        
        console.log('æ–°æ–‡ç« :', newPost);
        
    } catch (error) {
        console.error('API è¯·æ±‚å¤±è´¥:', error.message);
    }
}

// testAPIClient();
```

```python !! py
import aiohttp
import asyncio
from typing import List, Dict, Any

class AsyncAPIClient:
    """å¼‚æ­¥ API å®¢æˆ·ç«¯"""
    
    def __init__(self, base_url: str):
        self.base_url = base_url
    
    async def get(self, endpoint: str) -> Dict[str, Any]:
        """GET è¯·æ±‚"""
        async with aiohttp.ClientSession() as session:
            async with session.get(f"{self.base_url}{endpoint}") as response:
                if response.status != 200:
                    raise aiohttp.ClientError(
                        f"HTTP {response.status}: {response.reason}"
                    )
                return await response.json()
    
    async def post(self, endpoint: str, data: Dict[str, Any]) -> Dict[str, Any]:
        """POST è¯·æ±‚"""
        async with aiohttp.ClientSession() as session:
            async with session.post(
                f"{self.base_url}{endpoint}",
                json=data
            ) as response:
                if response.status != 201:
                    raise aiohttp.ClientError(
                        f"HTTP {response.status}: {response.reason}"
                    )
                return await response.json()
    
    async def batch_get(self, endpoints: List[str]) -> List[Dict[str, Any]]:
        """æ‰¹é‡ GET è¯·æ±‚"""
        async with aiohttp.ClientSession() as session:
            tasks = [
                self._get_with_session(session, endpoint)
                for endpoint in endpoints
            ]
            return await asyncio.gather(*tasks)
    
    async def _get_with_session(self, session: aiohttp.ClientSession, endpoint: str):
        """ä½¿ç”¨ç°æœ‰ä¼šè¯çš„ GET è¯·æ±‚"""
        async with session.get(f"{self.base_url}{endpoint}") as response:
            if response.status != 200:
                raise aiohttp.ClientError(
                    f"HTTP {response.status}: {response.reason}"
                )
            return await response.json()

# ä½¿ç”¨ API å®¢æˆ·ç«¯
async def test_api_client():
    """æµ‹è¯• API å®¢æˆ·ç«¯"""
    client = AsyncAPIClient('https://jsonplaceholder.typicode.com')
    
    try:
        # å•ä¸ªè¯·æ±‚
        user = await client.get('/users/1')
        print('ç”¨æˆ·ä¿¡æ¯:', user)
        
        # æ‰¹é‡è¯·æ±‚
        posts, comments, albums = await client.batch_get([
            '/posts/1',
            '/comments/1',
            '/albums/1'
        ])
        
        print('æ‰¹é‡è¯·æ±‚ç»“æœ:', {
            'posts': posts,
            'comments': comments,
            'albums': albums
        })
        
        # POST è¯·æ±‚
        new_post = await client.post('/posts', {
            'title': 'æµ‹è¯•æ–‡ç« ',
            'body': 'è¿™æ˜¯æµ‹è¯•å†…å®¹',
            'userId': 1
        })
        
        print('æ–°æ–‡ç« :', new_post)
        
    except Exception as error:
        print('API è¯·æ±‚å¤±è´¥:', error)

    # è¿è¡Œæµ‹è¯•
    # åœ¨ Pyodide ç¯å¢ƒä¸­ï¼Œç›´æ¥è°ƒç”¨å¼‚æ­¥å‡½æ•°
asyncio.create_task(main())
```
</PythonEditor>

## 8. æ€»ç»“ä¸æ‰©å±•å­¦ä¹ è·¯å¾„
Python çš„å¼‚æ­¥ç¼–ç¨‹èƒ½åŠ›ï¼Œè™½ç„¶èµ·æ­¥ç¨æ™šï¼Œä½†å¦‚ä»Šå·²ç»éå¸¸æˆç†Ÿï¼Œé€‚ç”¨äº I/O å¯†é›†å‹åœºæ™¯ã€Web åç«¯ã€çˆ¬è™«ã€å®æ—¶æ•°æ®å¤„ç†ç­‰é¢†åŸŸã€‚é€šè¿‡æœ¬æ•™ç¨‹ï¼Œä½ å·²ç»å®Œæˆäº†ä»åŸºç¡€è¯­æ³•åˆ°å®é™…é¡¹ç›®çš„å…¨é¢æŒæ¡ã€‚

### å­¦ä¹ å›é¡¾
ç†è§£äº† Python ä¸­ async/await çš„ä½¿ç”¨æ–¹å¼åŠå…¶ä¸ JavaScript çš„å¼‚åŒ

ç†Ÿæ‚‰äº†äº‹ä»¶å¾ªç¯ã€å¹¶å‘æ‰§è¡Œã€å¼‚æ­¥ç”Ÿæˆå™¨ã€ä¸Šä¸‹æ–‡ç®¡ç†å™¨ç­‰é«˜çº§ç‰¹æ€§

ç»“åˆ FastAPI ä¸ asyncpg å®ç°äº†å®Œæ•´çš„å¼‚æ­¥ Web æœåŠ¡ä¸æ•°æ®åº“äº¤äº’

ç¼–å†™äº†çˆ¬è™«ã€ä»»åŠ¡é˜Ÿåˆ—ã€API å®¢æˆ·ç«¯ç­‰å®ç”¨å¼‚æ­¥é¡¹ç›®ç¤ºä¾‹

ç»ƒä¹ äº†çœŸå®åœºæ™¯ä¸‹çš„æ•°æ®å¤„ç†æµç¨‹

### æ¨èæ‰©å±•
ä»¥ä¸‹æ˜¯ä¸‹ä¸€æ­¥æ·±å…¥å¼‚æ­¥ç¼–ç¨‹çš„å­¦ä¹ å»ºè®®ï¼š

#### ğŸ“š æ¡†æ¶ä¸åº“
FastAPIï¼šæ·±å…¥ä½¿ç”¨ä¾èµ–æ³¨å…¥ã€åå°ä»»åŠ¡ã€ä¸­é—´ä»¶ç­‰åŠŸèƒ½

aiohttpï¼šæ„å»ºå¼‚æ­¥ HTTP å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯

Starletteï¼šFastAPI çš„åº•å±‚å¼‚æ­¥æ¡†æ¶ï¼Œå¯å®ç°æ›´ä½å±‚çº§çš„å¼‚æ­¥ Web æœåŠ¡

Trio / Curioï¼šå¦ç±»å¼‚æ­¥åº“ï¼Œæä¾›ç»“æ„åŒ–å¹¶å‘çš„ç¼–ç¨‹èŒƒå¼

#### ğŸ› ï¸ å·¥å…·ä¸è°ƒè¯•
asyncio.TaskGroup (Python 3.11+)ï¼šæ›´å®‰å…¨çš„å¹¶å‘æ‰§è¡Œæ¨¡å‹

aiomonitor / aiodebugï¼šè°ƒè¯•å¼‚æ­¥äº‹ä»¶å¾ªç¯

pytest-asyncioï¼šç¼–å†™å¼‚æ­¥æµ‹è¯•ç”¨ä¾‹

#### ğŸ’¡ å®è·µé¡¹ç›®å»ºè®®
å®ç°ä¸€ä¸ª å¼‚æ­¥å¾®æœåŠ¡æ¶æ„ï¼Œé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—è¿æ¥å¤šä¸ªå¼‚æ­¥æœåŠ¡

æ„å»ºä¸€ä¸ª åŸºäº WebSocket çš„å®æ—¶èŠå¤©å®¤

ç¼–å†™ä¸€ä¸ª å¼‚æ­¥æ•°æ®èšåˆå™¨ï¼Œæ•´åˆå¤šä¸ª API çš„å¼‚æ­¥å“åº”

ğŸ§  æ€è€ƒé¢˜ï¼šç›¸æ¯”ä¼ ç»Ÿå¤šçº¿ç¨‹ï¼Œå¤šè¿›ç¨‹ç¼–ç¨‹ï¼Œå¼‚æ­¥ç¼–ç¨‹æœ‰å“ªäº›ä¼˜åŠ¿å’Œé™åˆ¶ï¼Ÿä½ ä¼šåœ¨å“ªäº›å®é™…é¡¹ç›®ä¸­ä¼˜å…ˆé€‰æ‹©å¼‚æ­¥æ–¹æ¡ˆï¼Ÿ

ğŸ‰ åˆ°è¿™é‡Œï¼Œä½ å·²ç»å®Œæˆäº† Python å¼‚æ­¥ç¼–ç¨‹çš„å…¨æ™¯å…¥é—¨ã€‚å¦‚æœä½ æ˜¯æ¥è‡ª JavaScript çš„èƒŒæ™¯ï¼Œç›¸ä¿¡ç°åœ¨ä½ å¯¹ Python çš„å¼‚æ­¥ä¸–ç•Œå·²ç»ä¸å†é™Œç”Ÿã€‚ç»§ç»­æ·±å…¥æ¢ç´¢ï¼Œå¼‚æ­¥å°†æˆä¸ºä½ å¼€å‘æ•ˆç‡çš„é‡è¦æ­¦å™¨ï¼