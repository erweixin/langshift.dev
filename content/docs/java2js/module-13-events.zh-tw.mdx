---
title: "Module 13: Event Handling"
description: "掌握 JavaScript 事件、傳播和事件委派"
---

## Module 13: Event Handling

事件是在瀏覽器中發生的動作。理解事件對於創建互動式網頁應用程式至關重要。

## Learning Objectives

完成本模組後，你將：
✅ 理解事件處理程序和監聽器
✅ 掌握事件傳播（冒泡和捕獲）
✅ 學習事件委派
✅ 知道常見事件類型
✅ 理解事件物件
✅ 掌握事件最佳實踐

## Event Handling: Java vs JavaScript

<UniversalEditor title="事件比較">
```java !! java
// Java - ActionListener
button.addActionListener(new ActionListener() {
    public void actionPerformed(ActionEvent e) {
        System.out.println("Clicked!");
    }
});

// Java 8+ Lambda
button.addActionListener(e -> System.out.println("Clicked!"));
```

```javascript !! js
// JavaScript - Event listeners
button.addEventListener("click", function(e) {
    console.log("Clicked!");
});

// Arrow function
button.addEventListener("click", (e) => {
    console.log("Clicked!");
});
```
</UniversalEditor>

## Adding Event Listeners

<UniversalEditor title="事件監聽器">
```javascript !! js
const button = document.querySelector("#myButton");

// Add listener
button.addEventListener("click", function(event) {
    console.log("Button clicked!");
});

// Named function（便於移除）
function handleClick(event) {
    console.log("Handled!");
}

button.addEventListener("click", handleClick);

// Remove listener
button.removeEventListener("click", handleClick);

// Options parameter
button.addEventListener("click", handleClick, {
    capture: false,      // 使用捕獲階段
    once: true,          // 第一次調用後移除
    passive: true        // 不阻止默認行為
});
```
</UniversalEditor>

## Event Propagation

<UniversalEditor title="事件階段">
```html
<div id="outer">
    <div id="middle">
        <div id="inner">Click me</div>
    </div>
</div>

<script>
// 三個階段：
// 1. 捕獲（向下）-> outer -> middle -> inner
// 2. 目標（在 inner）
// 3. 冒泡（向上）-> inner -> middle -> outer

// Bubbling phase（默認）
inner.addEventListener("click", () => console.log("Inner bubble"));
outer.addEventListener("click", () => console.log("Outer bubble"));

// Stop propagation
inner.addEventListener("click", (e) => {
    e.stopPropagation();  // 阻止事件繼續傳播
});
</script>
```
</UniversalEditor>

## Event Delegation

<UniversalEditor title="事件委派">
```javascript !! js
// Bad: 個別監聽器（記憶體密集）
const buttons = document.querySelectorAll("button");
buttons.forEach(button => {
    button.addEventListener("click", handleClick);
});

// Good: 事件委派（單一監聽器）
document.addEventListener("click", (e) => {
    if (e.target.matches("button")) {
        handleClick(e);
    }
});

// 實用：動態內容
const list = document.getElementById("list");

// 在父級添加監聽器
list.addEventListener("click", (e) => {
    const item = e.target.closest("li");
    if (!item) return;
    
    console.log("Clicked:", item.textContent);
});

// 動態添加項目（無需添加監聽器）
function addItem(text) {
    const li = document.createElement("li");
    li.textContent = text;
    list.appendChild(li);
}
```
</UniversalEditor>

## Common Events

<UniversalEditor title="常見事件">
```javascript !! js
// Mouse events
element.addEventListener("click", handler);
element.addEventListener("dblclick", handler);
element.addEventListener("mousedown", handler);
element.addEventListener("mouseup", handler);
element.addEventListener("mouseover", handler);
element.addEventListener("mouseout", handler);

// Keyboard events
element.addEventListener("keydown", handler);
element.addEventListener("keyup", handler);

// Form events
form.addEventListener("submit", handler);
input.addEventListener("input", handler);      // 任何更改時
input.addEventListener("change", handler);     // on blur
input.addEventListener("focus", handler);
input.addEventListener("blur", handler);

// Document events
document.addEventListener("DOMContentLoaded", handler);
window.addEventListener("load", handler);
window.addEventListener("resize", handler);
window.addEventListener("scroll", handler);

// 實用：鍵盤快捷鍵
document.addEventListener("keydown", (e) => {
    // Ctrl+S
    if (e.ctrlKey && e.key === "s") {
        e.preventDefault();
        save();
    }
    
    // Escape
    if (e.key === "Escape") {
        closeModal();
    }
});
```
</UniversalEditor>

## Event Object

<UniversalEditor title="事件物件">
```javascript !! js
element.addEventListener("click", (e) => {
    // Target vs currentTarget
    console.log(e.target);        // 被點擊的元素
    console.log(e.currentTarget);  // 有監聽器的元素
    
    // Coordinates
    console.log(e.clientX, e.clientY);  // 相對於視口
    console.log(e.pageX, e.pageY);      // 相對於文件
    
    // Modifiers
    console.log(e.ctrlKey);
    console.log(e.shiftKey);
    console.log(e.altKey);
    
    // Prevent default
    e.preventDefault();  // 阻止默認行為
    
    // Stop propagation
    e.stopPropagation();  // 阻止冒泡
});
```
</UniversalEditor>

## Best Practices

<UniversalEditor title="事件最佳實踐">
```javascript !! js
// 1. 對動態內容使用事件委派
container.addEventListener("click", (e) => {
    if (e.target.matches(".item")) {
        handleItemClick(e);
    }
});

// 2. 完成後移除監聽器
function setup() {
    const handler = (e) => console.log(e);
    button.addEventListener("click", handler);
    
    // 之後
    button.removeEventListener("click", handler);
}

// 3. 對 scroll/touch 使用被動監聽器
window.addEventListener("scroll", handler, { passive: true });

// 4. 對昂貴的處理程序使用 debounce
const handleResize = debounce(() => {
    // 昂貴的操作
}, 100);

window.addEventListener("resize", handleResize);
```
</UniversalEditor>

## Summary

### Key Takeaways

1. **Listeners:** addEventListener 是首選
2. **Propagation:** 捕獲 → 目標 → 冒泡
3. **Delegation:** 單一監聽器處理多個元素
4. **Best:** 使用委派、移除未使用的監聽器

## What's Next?

接下來是 **Module 14: ES6+ Modules** - 學習現代 JavaScript 模組系統！
