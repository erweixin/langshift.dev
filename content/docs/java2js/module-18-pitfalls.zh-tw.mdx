---
title: "Module 18: Common Pitfalls"
description: "Avoid common JavaScript mistakes and anti-patterns"
---

## Module 18: Common Pitfalls

本模組涵蓋 Java 開發者在轉向 JavaScript 時常犯的錯誤。

## Learning Objectives

完成本模組後，您將：
✅ 知道常見的 JavaScript 陷阱
✅ 了解型別轉換問題
✅ 學習 async/await 錯誤
✅ 知道 DOM 操作問題
✅ 了解 this 相關問題
✅ 掌握除錯策略

## Type Coercion

<UniversalEditor title="型別轉換陷阱">
```javascript !! js
// ❌ BAD: Using == instead of ===
if (value == "0") { }  // Matches 0, "0", false

// ✅ GOOD: Use ===
if (value === "0") { }

// ❌ BAD: Forgetting typeof null
typeof null  // "object" (historical bug)

// ✅ GOOD: Check for null properly
if (value === null) { }

// ❌ BAD: NaN comparison
if (NaN === NaN) { }  // Never true!

// ✅ GOOD: Use isNaN
if (Number.isNaN(value)) { }
```
</UniversalEditor>

## Async Pitfalls

<UniversalEditor title="非同步錯誤">
```javascript !! js
// ❌ BAD: Not awaiting promises
async function getData() {
  const result = fetch("/api/data");  // Returns promise, not data!
  console.log(result);  // Promise {<pending>}
}

// ✅ GOOD: Await the promise
async function getData() {
  const result = await fetch("/api/data");
  const data = await result.json();
  console.log(data);
}

// ❌ BAD: Forgetting try-catch
async function risky() {
  const data = await fetchData();  // Unhandled rejection!
}

// ✅ GOOD: Always handle errors
async function risky() {
  try {
    const data = await fetchData();
    return data;
  } catch (error) {
    console.error(error);
    throw error;
  }
}
```
</UniversalEditor>

## This Context

<UniversalEditor title="This 陷阱">
```javascript !! js
// ❌ BAD: Losing this in callbacks
class Component {
  constructor() {
    this.data = null;

    button.addEventListener("click", this.handleClick);
  }

  handleClick() {
    console.log(this.data);  // undefined!
  }
}

// ✅ GOOD: Bind or use arrow
class Component {
  constructor() {
    this.data = null;

    // Bind
    this.handleClick = this.handleClick.bind(this);
    button.addEventListener("click", this.handleClick);

    // Or arrow
    button.addEventListener("click", () => this.handleClick());
  }
}
```
</UniversalEditor>

## Loop Closures

<UniversalEditor title="迴圈閉包問題">
```javascript !! js
// ❌ BAD: Closure in loop with var
for (var i = 0; i < 3; i++) {
  setTimeout(() => console.log(i), 100);
}
// Output: 3, 3, 3

// ✅ GOOD: Use let
for (let i = 0; i < 3; i++) {
  setTimeout(() => console.log(i), 100);
}
// Output: 0, 1, 2
```
</UniversalEditor>

## Array Methods

<UniversalEditor title="陣列方法陷阱">
```javascript !! js
// ❌ BAD: forEach when need to break
numbers.forEach(num => {
  if (num === 5) break;  // Error!
});

// ✅ GOOD: Use for...of
for (const num of numbers) {
  if (num === 5) break;
}

// ❌ BAD: Forgetting return in map
const doubled = numbers.map(n => {
  n * 2;  // No return!
});

// ✅ GOOD: Always return
const doubled = numbers.map(n => n * 2);
```
</UniversalEditor>

## Best Practices Summary

<UniversalEditor title="避免這些錯誤">
```javascript !! js
// 1. Always use === and !==
// 2. Use let/const, never var
// 3. Handle async errors
// 4. Understand this binding
// 5. Use for...of to break loops
// 6. Return in map/filter/reduce
// 7. Check for null/undefined
// 8. Don't modify while iterating
```
</UniversalEditor>

## Summary

### Key Takeaways

1. **Equality**: 使用 ===，而非 ==
2. **Async**: 始終 await 和 catch
3. **This**: 綁定或使用箭頭函式
4. **Loops**: 使用 let，而非 var
5. **Arrays**: 在回呼函式中回傳
6. **Null**: 明確檢查

## What's Next?

下一個：**Module 19: Real Projects** - 建構實用的應用程式！
