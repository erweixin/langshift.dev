---
title: "模块 16：测试与调试"
description: "掌握 JavaScript 测试框架和调试技巧"
---

## 模块 16：测试与调试

测试和调试是编写可靠 JavaScript 代码的必备技能。

## 学习目标

完成本模块后，你将：
✅ 掌握 Jest 测试框架
✅ 学习测试模式（单元测试、集成测试、端到端测试）
✅ 理解调试技巧
✅ 了解浏览器开发者工具
✅ 学习错误处理策略
✅ 掌握测试最佳实践

## 测试：Java vs JavaScript

<UniversalEditor title="测试对比">
```java !! java
// Java - JUnit
import org.junit.jupiter.api.Test;
import static org.junit.jupiter.api.Assertions.*;

public class CalculatorTest {
    @Test
    public void testAdd() {
        Calculator calc = new Calculator();
        assertEquals(5, calc.add(2, 3));
    }
}
```

```javascript !! js
// JavaScript - Jest
test("add 返回和", () => {
    const calc = new Calculator();
    expect(calc.add(2, 3)).toBe(5);
});
```
</UniversalEditor>

## Jest 测试

<UniversalEditor title="Jest 基础">
```javascript !! js
// math.test.js
const { add, subtract } = require("./math");

describe("数学运算", () => {
  test("add 加法运算", () => {
    expect(add(2, 3)).toBe(5);
  });

  test("subtract 减法运算", () => {
    expect(subtract(5, 3)).toBe(2);
  });

  // 匹配器
  test("匹配器", () => {
    expect(42).toBe(42);
    expect({ name: "John" }).toEqual({ name: "John" });
    expect("hello").toContain("ell");
    expect([1, 2, 3]).toHaveLength(3);
    expect(null).toBeNull();
    expect(undefined).toBeUndefined();
    expect(true).toBeTruthy();
    expect(false).toBeFalsy();
  });
});

// 异步测试
test("异步获取数据", async () => {
  const data = await fetchData();
  expect(data).toBeDefined();
});

// 模拟
test("模拟函数", () => {
  const mock = jest.fn();
  mock("arg1", "arg2");

  expect(mock).toHaveBeenCalledWith("arg1", "arg2");
  expect(mock).toHaveBeenCalledTimes(1);
});
```
</UniversalEditor>

## 调试

<UniversalEditor title="调试技巧">
```javascript !! js
// 1. console.log（最简单）
console.log("值:", value);
console.table(data);  // 表格数据
console.group("分组");
console.log("组内");
console.groupEnd();

// 2. debugger 语句
function buggyFunction() {
  const x = 1;
  debugger;  // 暂停执行
  const y = 2;
  return x + y;
}

// 3. Chrome 开发者工具
// - Sources 面板
// - 设置断点
// - 单步执行代码
// - 检查变量

// 4. 错误处理
try {
  riskyOperation();
} catch (error) {
  console.error("捕获错误:", error);
  console.trace();  // 堆栈跟踪
}

// 5. 性能分析
console.time("操作");
// ... 代码 ...
console.timeEnd("操作");
```
</UniversalEditor>

## 浏览器开发者工具

<UniversalEditor title="开发者工具">
```html
<!-- 打开开发者工具：F12 或 Cmd+Option+I -->

<!-- Elements：检查 DOM -->
<!-- Console：执行 JS -->
<!-- Sources：调试代码 -->
<!-- Network：监控请求 -->
<!-- Performance：性能分析 -->
```
</UniversalEditor>

## 测试模式

<UniversalEditor title="测试模式">
```javascript !! js
// 单元测试
describe("UserService", () => {
  test("创建用户", () => {
    const user = new User("John");
    expect(user.name).toBe("John");
  });
});

// 集成测试
describe("API", () => {
  test("获取用户", async () => {
    const response = await fetch("/api/users/1");
    const user = await response.json();
    expect(user.id).toBe(1);
  });
});

// 模拟外部依赖
jest.mock("./api");
import { fetchUser } from "./api";

test("显示用户", async () => {
  fetchUser.mockResolvedValue({ id: 1, name: "John" });

  const user = await getUser(1);
  expect(user.name).toBe("John");
});
```
</UniversalEditor>

## 最佳实践

<UniversalEditor title="测试最佳实践">
```javascript !! js
// 1. 测试行为，而非实现
// 坏的做法
test("使用 array.push", () => {
  arr.push(1);
  expect(arr.push).toHaveBeenCalled();
});

// 好的做法
test("添加项到数组", () => {
  addItem(arr, 1);
  expect(arr).toContain(1);
});

// 2. 安排-执行-断言
test("用户可以登录", () => {
  // 安排
  const user = { email: "test@test.com", password: "pass" };

  // 执行
  const result = authService.login(user);

  // 断言
  expect(result.success).toBe(true);
});

// 3. 每个测试一个断言（主要）
test("返回用户数据", () => {
  const user = getUser(1);
  expect(user.id).toBe(1);
  // 不要在一个测试中测试所有内容
});

// 4. 使用描述性测试名称
test("用户未找到时返回 404", () => {
  // 清楚地测试了什么
});
```
</UniversalEditor>

## 总结

### 关键要点

1. **Jest**：测试框架
2. **匹配器**：toBe、toEqual、toContain
3. **异步**：await 异步测试
4. **模拟**：jest.fn()、jest.mock()
5. **调试**：console.log、debugger、开发者工具

### 对比：Java vs JavaScript

| 特性 | Java | JavaScript |
|---------|------|------------|
| **测试** | JUnit | Jest |
| **模拟** | Mockito | jest.fn() |
| **调试** | IDE 调试器 | 浏览器开发者工具 |
| **性能分析** | JProfiler | Chrome 开发者工具 |

## 接下来是什么？

下一节：**模块 17：流行框架** - 学习 React 和 Vue 基础！
