---
title: "æ¨¡å— 20: REST API é¡¹ç›®"
description: "ä½¿ç”¨ Axum æ„å»ºå®Œæ•´çš„ REST API,åŒ…æ‹¬æ•°æ®åº“é›†æˆã€JWT è®¤è¯ã€æµ‹è¯•å’Œéƒ¨ç½²"
---

# æ¨¡å— 20: REST API é¡¹ç›®

## å­¦ä¹ ç›®æ ‡

å®Œæˆæœ¬æ¨¡å—å,ä½ å°†æ„å»º:
- ä½¿ç”¨ Axum çš„å®Œæ•´ REST API
- ä½¿ç”¨ SQLx çš„æ•°æ®åº“é›†æˆ
- JWT è®¤è¯ç³»ç»Ÿ
- å…¨é¢çš„æµ‹è¯•å¥—ä»¶
- ç”Ÿäº§å°±ç»ªçš„éƒ¨ç½²è®¾ç½®

## é¡¹ç›®æ¦‚è¿°

æˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªä»»åŠ¡ç®¡ç† API,åŒ…å«:
- ç”¨æˆ·æ³¨å†Œå’Œè®¤è¯
- ä»»åŠ¡çš„ CRUD æ“ä½œ
- åŸºäº JWT çš„è®¤è¯
- PostgreSQL æ•°æ®åº“
- å…¨é¢çš„æµ‹è¯•

<UniversalEditor compare={true} title="é¡¹ç›®ç»“æ„">
```python !! py
# Python - FastAPI é¡¹ç›®ç»“æ„
task_api/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ main.py          # FastAPI åº”ç”¨
â”‚   â”œâ”€â”€ models.py        # SQLAlchemy æ¨¡å‹
â”‚   â”œâ”€â”€ auth.py          # è®¤è¯
â”‚   â””â”€â”€ database.py      # æ•°æ®åº“è®¾ç½®
â”œâ”€â”€ tests/
â””â”€â”€ requirements.txt
```

```rust !! rs
// Rust - Axum é¡¹ç›®ç»“æ„
task_api/
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.rs          # Axum åº”ç”¨è®¾ç½®
â”‚   â”œâ”€â”€ models.rs        # æ•°æ®åº“æ¨¡å‹
â”‚   â”œâ”€â”€ handlers.rs      # è¯·æ±‚å¤„ç†
â”‚   â”œâ”€â”€ auth.rs          # JWT è®¤è¯
â”‚   â””â”€â”€ db.rs            # æ•°æ®åº“è¿æ¥
â””â”€â”€ tests/
```
</UniversalEditor>

## Cargo.toml è®¾ç½®

<UniversalEditor compare={true} title="ä¾èµ–é¡¹">
```python !! py
# Python - requirements.txt
fastapi==0.109.0
uvicorn[standard]==0.27.0
sqlalchemy==2.0.25
pydantic==2.5.3
python-jose[cryptography]==3.3.0
passlib[bcrypt]==1.7.4
```

```rust !! rs
// Rust - Cargo.toml
[dependencies]
axum = "0.7"
tokio = { version = "1", features = ["full"] }
sqlx = { version = "0.7", features = ["runtime-tokio-rustls", "postgres", "uuid", "chrono"] }
serde = { version = "1", features = ["derive"] }
serde_json = "1"
uuid = { version = "1", features = ["serde", "v4"] }
chrono = { version = "0.4", features = ["serde"] }
jsonwebtoken = "9"
bcrypt = "0.15"
tower-http = { version = "0.5", features = ["cors", "trace"] }
anyhow = "1"
```
</UniversalEditor>

## æ•°æ®åº“æ¨¡å‹

<UniversalEditor compare={true} title="æ•°æ®æ¨¡å‹">
```python !! py
# Python - SQLAlchemy æ¨¡å‹
from sqlalchemy import Column, String, Boolean, DateTime
from sqlalchemy.dialects.postgresql import UUID
import uuid

class User(Base):
    __tablename__ = "users"

    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
    email = Column(String, unique=True, nullable=False, index=True)
    password_hash = Column(String, nullable=False)
    created_at = Column(DateTime, default=datetime.utcnow)
```

```rust !! rs
// Rust - SQLx æ¨¡å‹
use chrono::{DateTime, Utc};
use serde::{Deserialize, Serialize};
use sqlx::FromRow;
use uuid::Uuid;

#[derive(Debug, Serialize, Deserialize, FromRow)]
pub struct User {
    pub id: Uuid,
    pub email: String,
    pub password_hash: String,
    pub created_at: DateTime<Utc>,
}

#[derive(Debug, Deserialize)]
pub struct CreateUser {
    pub email: String,
    pub password: String,
}
```
</UniversalEditor>

## ä¸»åº”ç”¨ç¨‹åº

<UniversalEditor compare={true} title="åº”ç”¨è®¾ç½®">
```python !! py
# Python - FastAPI åº”ç”¨
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware

app = FastAPI(title="Task API")

app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:3000"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

@app.get("/")
async def root():
    return {"message": "Task API"}
```

```rust !! rs
// Rust - Axum åº”ç”¨
use axum::{
    routing::{get, post},
    Router,
};
use tower_http::cors::{CorsLayer, Any};

#[tokio::main]
async fn main() -> anyhow::Result<()> {
    let app = Router::new()
        .route("/", get(root))
        .route("/register", post(register))
        .route("/tasks", get(list_tasks).post(create_task))
        .layer(CorsLayer::new().allow_origin(Any))
        .with_state(app_state);

    let listener = TcpListener::bind("0.0.0.0:8000").await?;
    axum::serve(listener, app).await?;

    Ok(())
}

async fn root() -> &'static str {
    "Task API"
}
```
</UniversalEditor>

## æ•°æ®åº“è¿ç§»

<UniversalEditor compare={true} title="è¿ç§»æ–‡ä»¶">
```sql !! sql
-- SQLx è¿ç§»
-- migrations/001_initial.sql

CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    email VARCHAR(255) NOT NULL UNIQUE,
    password_hash VARCHAR(255) NOT NULL,
    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

CREATE TABLE tasks (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    title VARCHAR(255) NOT NULL,
    description TEXT,
    completed BOOLEAN NOT NULL DEFAULT FALSE,
    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);
```
</UniversalEditor>

## éƒ¨ç½²

<UniversalEditor compare={true} title="éƒ¨ç½²é…ç½®">
```dockerfile !! dockerfile
# Rust - Dockerfile
FROM rust:1.75 as builder

WORKDIR /app
COPY Cargo.toml Cargo.lock ./
COPY src ./src

RUN cargo build --release

FROM debian:bookworm-slim

WORKDIR /app
COPY --from=builder /app/target/release/task_api /app/task_api

EXPOSE 8000

CMD ["./task_api"]
```

```yaml !! yaml
# docker-compose.yml
version: '3.8'

services:
  api:
    build: .
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=postgresql://user:pass@db:5432/taskdb
    depends_on:
      - db

  db:
    image: postgres:16
    environment:
      - POSTGRES_DB=taskdb
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=pass
    volumes:
      - postgres_data:/var/lib/postgresql/data

volumes:
  postgres_data:
```
</UniversalEditor>

## é¡¹ç›®æ€»ç»“

### æˆ‘ä»¬æ„å»ºäº†ä»€ä¹ˆ

1. **ä½¿ç”¨ Axum çš„ REST API**
   - ç”¨æˆ·æ³¨å†Œå’Œè®¤è¯
   - ä»»åŠ¡çš„ CRUD æ“ä½œ
   - åŸºäº JWT çš„å®‰å…¨

2. **æ•°æ®åº“é›†æˆ**
   - ä½¿ç”¨ SQLx çš„ PostgreSQL
   - ç±»å‹å®‰å…¨çš„æŸ¥è¯¢
   - è¿ç§»æ”¯æŒ

3. **ç”Ÿäº§å°±ç»ª**
   - Docker éƒ¨ç½²
   - ç¯å¢ƒé…ç½®
   - é”™è¯¯å¤„ç†

### å…³é”®è¦ç‚¹

**Python/FastAPI:**
- å¿«é€Ÿå¼€å‘
- æ˜“äºé˜…è¯»å’Œä¿®æ”¹
- åŠ¨æ€ç±»å‹çµæ´»æ€§
- é€‚åˆåŸå‹å¼€å‘

**Rust/Axum:**
- ç±»å‹å®‰å…¨çš„æ•°æ®åº“æŸ¥è¯¢
- é›¶æˆæœ¬æŠ½è±¡
- å†…å­˜å®‰å…¨ä¿è¯
- å“è¶Šçš„æ€§èƒ½
- ç¼–è¯‘æ—¶é”™è¯¯æ£€æŸ¥

## æœ€ç»ˆç»ƒä¹ 

1. æ·»åŠ ä»»åŠ¡è¿‡æ»¤å’Œåˆ†é¡µ
2. å®ç°ä»»åŠ¡åˆ†ç±»/æ ‡ç­¾
3. æ·»åŠ é‚®ä»¶é€šçŸ¥
4. åˆ›å»ºå‰ç«¯å®¢æˆ·ç«¯
5. éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

## ç»“è¯­

æ­å–œ!ä½ å·²å®Œæˆ Python åˆ° Rust çš„å­¦ä¹ è·¯å¾„ã€‚ä½ ç°åœ¨æ‹¥æœ‰:

- Rust è¯­æ³•å’Œæ¦‚å¿µçš„åšå®åŸºç¡€
- å®é™… Rust å¼€å‘ç»éªŒ
- ç†è§£ Rust çš„æ€§èƒ½ä¼˜åŠ¿
- æµ‹è¯•å’Œéƒ¨ç½²å®è·µçŸ¥è¯†

ç»§ç»­ä½ çš„ Rust ä¹‹æ—…:
- ä¸ºå¼€æº Rust é¡¹ç›®åšè´¡çŒ®
- æ„å»ºæ›´å¤æ‚çš„åº”ç”¨
- æ·±å…¥æ¢ç´¢å¼‚æ­¥ Rust
- å­¦ä¹ ä½¿ç”¨ Rust çš„ WebAssembly

æ„‰å¿«åœ°ä½¿ç”¨ Rust ç¼–ç ! ğŸ¦€
