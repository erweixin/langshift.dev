---
title: "模組 17: 測試"
description: "掌握 Rust 測試,包括單元測試、整合測試、基於屬性的測試和模擬策略"
---

# 模組 17: 測試

## 學習目標

完成本模組後,你將能夠:
- 使用 `#[test]` 屬性編寫單元測試
- 在 `tests/` 目錄中建立整合測試
- 使用斷言和自訂測試輸出
- 使用 Tokio 測試非同步程式碼
- 使用 proptest 實作基於屬性的測試
- 為隔離測試模擬依賴

## Rust 測試簡介

Rust 有內建的測試支援,不像 Python 需要外部框架(雖然 pytest 非常流行)。

<UniversalEditor compare={true} title="基本測試設定">
```python !! py
# Python - pytest 結構
# test_calculator.py
import pytest

def add(a: int, b: int) -> int:
    return a + b

def test_add_positive():
    assert add(2, 3) == 5

def test_add_negative():
    assert add(-1, 1) == 0

# 執行: pytest test_calculator.py
```

```rust !! rs
// Rust - 內建測試
fn add(a: i32, b: i32) -> i32 {
    a + b
}

#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_add_positive() {
        assert_eq!(add(2, 3), 5);
    }

    #[test]
    fn test_add_negative() {
        assert_eq!(add(-1, 1), 0);
    }
}

// 執行: cargo test
```
</UniversalEditor>

## 單元測試 vs 整合測試

Rust 有兩種不同位置的測試類型:

<UniversalEditor compare={true} title="測試組織">
```python !! py
# Python - 平坦結構
# src/calculator.py
def add(a, b):
    return a + b

# tests/test_calculator.py
from calculator import add

def test_add():
    assert add(2, 3) == 5
```

```rust !! rs
// Rust - 分離的單元和整合測試
// src/lib.rs
pub fn add(a: i32, b: i32) -> i32 {
    a + b
}

// 單元測試:在同一檔案中
#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_add() {
        assert_eq!(add(2, 3), 5);
    }
}

// 整合測試:在 tests/ 目錄中
// tests/integration_test.rs
use my_crate::add;

#[test]
fn test_integration_add() {
    assert_eq!(add(10, 20), 30);
}
```
</UniversalEditor>

**關鍵點:**
- **單元測試**: 測試私有函式,放在同一模組中
- **整合測試**: 測試公共 API,放在 `tests/` 目錄中

## 執行測試

<UniversalEditor compare={true} title="測試指令">
```bash !! bash
# Python - pytest 指令
# 執行所有測試
pytest

# 執行特定檔案
pytest test_calculator.py

# 詳細輸出
pytest -v
```

```rust !! rs
// Rust - cargo test 指令
// 執行所有測試
cargo test

// 執行特定測試
cargo test test_add

// 詳細輸出(顯示列印輸出)
cargo test -- --nocapture

// 發布模式執行測試(更快)
cargo test --release
```
</UniversalEditor>

## 關鍵要點

### 測試哲學
- **Python**: 強調簡單性和表現力
- **Rust**: 內建測試,注重安全性和效能

### 測試組織
- **Python**: 測試在 `test_*.py` 檔案中
- **Rust**: 單元測試在同一檔案,整合測試在 `tests/` 目錄

## 練習

1. 為計算器的所有基本操作編寫單元測試
2. 為 REST API 客戶端建立整合測試
3. 為排序演算法實作基於屬性的測試
4. 為資料庫 trait 建構模擬實作

## 下一模組

在模組 18 中,我們將探索 **Rust 巨集**,包括使用 `macro_rules!` 的宣告式巨集、派生巨集和程序巨集。
