---
title: "模块 0：介绍与环境搭建"
description: "通过了解 Rust 的重要性、安装工具链和编写第一个 Rust 程序来开始你的 Rust 之旅。"
---

# 模块 0：介绍与环境搭建

欢迎来到你的 Rust 之旅！在本模块中，你将学习为什么 Rust 值得你投入时间，安装 Rust 工具链，并编写你的第一个 Rust 程序。

## 学习目标

完成本模块后，你将能够：
- ✅ 理解 Rust 的独特和价值所在
- ✅ 安装 Rust 并设置开发环境
- ✅ 使用 Cargo（Rust 的包管理器和构建工具）
- ✅ 编写并运行第一个 Rust 程序
- ✅ 导航 Rust 生态系统和资源

## 为什么选择 Rust？Python 开发者的视角

作为 Python 开发者，你可能会想："为什么要学习另一种语言？" 让我们探索 Rust 带来的价值。

<UniversalEditor compare={true} title="开发体验：Python vs Rust">
```python !! py
# Python: 编写快，运行慢
def process_data(items):
    result = []
    for item in items:
        result.append(item * 2)
    return result

# 运行速度比优化后的 Rust 慢约 100 倍
# 但只需 5 秒钟编写
```

```rust !! rs
// Rust: 更冗长，但速度极快
fn process_data(items: &[i32]) -> Vec<i32> {
    items.iter().map(|x| x * 2).collect()
}

// 运行速度达到 C/C++ 级别
// 初始编写时间稍长
// 但编译器在运行前就能捕获错误
```
</UniversalEditor>

### Rust 的价值主张

#### 1. 不牺牲安全性的性能

Python 使用全局解释器锁（GIL）和垃圾回收，这限制了性能并使真正的并行性变得具有挑战性。Rust 为你提供：
- **C/C++ 性能** 而没有内存安全风险
- **真正的并行性** 通过无畏并发
- **可预测的性能** 没有垃圾回收暂停

<UniversalEditor compare={true} title="性能对比：斐波那契数列">
```python !! py
# Python: fib(35) 约 2.5 秒
import time

def fib(n):
    if n <= 1:
        return n
    return fib(n-1) + fib(n-2)

start = time.time()
print(fib(35))
print(f"耗时: {time.time() - start:.2f}秒")
```

```rust !! rs
// Rust: fib(35) 约 0.7 秒（快 3.5 倍）
use std::time::Instant;

fn fib(n: u64) -> u64 {
    match n {
        0 => 0,
        1 => 1,
        _ => fib(n-1) + fib(n-2),
    }
}

fn main() {
    let start = Instant::now();
    println!("{}", fib(35));
    println!("耗时: {:?}", start.elapsed());
}
```
</UniversalEditor>

#### 2. 编译时的内存安全

这是 Rust 的超能力。Rust 编译器可以防止整类错误：
- **空指针解引用** → Rust 没有null
- **悬垂指针** → 借用检查器防止无效引用
- **数据竞争** → 类型系统防止并发数据访问问题
- **缓冲区溢出** → 默认边界检查

在 Python 中，这些将是运行时错误。在 Rust 中，它们是 **编译时错误** - 你在代码运行之前就能发现它们。

#### 3. 现代工具链

Cargo 是现有的最好的包管理器之一：

<UniversalEditor compare={true} title="包管理：pip vs Cargo">
```python !! py
# Python: 多个工具，配置分散
# 创建项目
mkdir myproject
cd myproject
python -m venv venv
source venv/bin/activate

# 添加依赖（手动编辑）
echo "numpy==1.24.0" >> requirements.txt
pip install -r requirements.txt

# 运行测试（需要单独的测试框架）
pytest

# 构建（用于分发）
python setup.py sdist bdist_wheel
```

```rust !! rs
// Rust: 统一的工具
// 创建项目
cargo new myproject
cd myproject

// 添加依赖
cargo add serde

// 运行测试（内置）
cargo test

// 构建优化后的二进制文件
cargo build --release
```
</UniversalEditor>

#### 4. 成长的生态系统

Rust 拥有快速增长的生态系统，提供出色的 crate：
- **Web**: Actix-web, Axum, Rocket
- **异步**: Tokio, async-std
- **序列化**: Serde (JSON, YAML 等)
- **数据库**: Diesel, SQLx
- **CLI**: Clap, structopt

许多 Python 库现在都有 Rust 加速（例如，用于 Python 绑定的 PyO3）。

## 安装 Rust

### 步骤 1：安装 rustup（Rust 工具链安装程序）

**macOS / Linux:**
```bash
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
```

**Windows:**
从 [rustup.rs](https://rustup.rs/) 下载并运行 `rustup-init.exe`

安装程序将：
1. 安装 Rust 编译器（`rustc`）
2. 安装 Cargo（包管理器和构建工具）
3. 将 Rust 添加到系统 PATH
4. 安装稳定版 Rust 工具链

**验证安装：**
```bash
rustc --version
cargo --version
```

你应该看到类似这样的输出：
```
rustc 1.75.0 (82e1608df 2023-12-21)
cargo 1.75.0 (1d8b05cdd 2023-11-20)
```

### 步骤 2：安装代码编辑器

**推荐：VS Code + rust-analyzer**

1. 安装 [VS Code](https://code.visualstudio.com/)
2. 安装 `rust-analyzer` 扩展（注意不是 "Rust" - 要用 rust-analyzer）
3. 安装 `CodeLLDB` 用于调试支持

**其他编辑器：**
- IntelliJ IDEA 配合 Rust 插件
- Vim/Neovim 配合 rust-tools.nvim
- Emacs 配合 rust-mode

rust-analyzer 提供：
- ✅ 自动补全
- ✅ 内联类型提示
- ✅ 转到定义
- ✅ 内联错误消息
- ✅ 代码操作（快速修复）

## 你的第一个 Rust 程序

让我们创建并运行你的第一个 Rust 项目！

### 创建新项目

```bash
cargo new hello_rust
cd hello_rust
```

Cargo 创建：
```
hello_rust/
├── Cargo.toml      # 项目元数据和依赖
└── src/
    └── main.rs     # 你的源代码
```

### 理解项目结构

**`Cargo.toml`** - 项目清单：
```toml
[package]
name = "hello_rust"
version = "0.1.0"
edition = "2021"

[dependencies]
# 外部 crate 放在这里
```

**`src/main.rs`** - 入口点：
```rust
fn main() {
    println!("Hello, world!");
}
```

### 运行你的项目

```bash
cargo run
```

你应该看到：
```
Compiling hello_rust v0.1.0
Finished dev profile [unoptimized + debuginfo] target(s)
Running `target/debug/hello_rust`
Hello, world!
```

## 理解代码

让我们分解发生了什么：

<UniversalEditor compare={true} title="Hello World：Python vs Rust">
```python !! py
# Python: 脚本式执行
# 不需要 main 函数 - 只是从上到下执行

def main():
    print("Hello, world!")

if __name__ == "__main__":
    main()

# 实际上，在 Python 中通常只需：
print("Hello, world!")
```

```rust !! rs
// Rust: 编译型，有显式入口点
// 每个 Rust 程序都需要 main() 函数

fn main() {  // fn 声明函数
    println!("Hello, world!");  // ! 表示宏
}

// 关键点：
// - fn: 函数关键字
// - main(): 入口点（类似 if __name__ == "__main__"）
// - {}: 函数体
// - println!: 宏调用（注意 !）
// - ;: 语句终止符
```
</UniversalEditor>

### 关键 Rust 概念（预览）

1. **`fn main()`**: 入口点函数
2. **`println!`**: 它是 **宏**（注意 `!`），不是函数
3. **`;`**: 语句必须以分号结尾
4. **`{}`**: 用于作用域的代码块

## Cargo 命令深入

Cargo 是 Rust 开发的瑞士军刀：

### 构建命令

```bash
# 开发版本构建（未优化，快速编译）
cargo build

# 发布版本构建（优化后，慢速编译，快速二进制）
cargo build --release

# 立即运行（必要时构建）
cargo run

# 运行发布版本
cargo run --release
```

### 开发命令

```bash
# 检查代码而不构建（最快）
cargo check

# 运行测试
cargo test

# 生成文档
cargo doc --open

# 创建新项目（二进制）
cargo new project_name

# 创建新项目（库）
cargo new --lib project_name

# 更新依赖
cargo update
```

### 有用的 Cargo 标志

```bash
# 显示详细输出
cargo build --verbose

# 仅编译特定目标
cargo build --bin hello_rust

# 编译特定示例
cargo build --example my_example

# 使用自定义参数运行
cargo run -- --some-arg
```

## Python 和 Rust 工作流对比

<UniversalEditor compare={true} title="项目结构对比">
```python !! py
# Python 项目结构
myproject/
├── src/
│   └── mymodule.py
├── tests/
│   └── test_mymodule.py
├── requirements.txt
├── setup.py 或 pyproject.toml
└── README.md

# 安装依赖
pip install -r requirements.txt

# 运行模块
python -m src.mymodule

# 运行测试
pytest

# 打包
python setup.py sdist
```

```rust !! rs
// Rust 项目结构
myproject/
├── src/
│   ├── main.rs       # 二进制入口点
│   └── lib.rs        # 库入口点（如果是 --lib）
├── tests/
│   └── integration_test.rs
├── examples/
│   └── example.rs
├── Cargo.toml        # 所有依赖在这里
└── README.md

// 构建和运行
cargo build
cargo run
cargo test

// 一切都由 Cargo 管理
```
</UniversalEditor>

## 设置开发环境

### 推荐的 VS Code 扩展

1. **rust-analyzer**（必需）
   - 官方语言服务器
   - 提供 IDE 功能

2. **CodeLLDB**
   - 调试支持

3. **Even Better TOML**
   - Cargo.toml 的语法高亮

4. **Error Lens**
   - 内联错误显示

### VS Code 设置

创建 `.vscode/settings.json`：
```json
{
    "rust-analyzer.checkOnSave.command": "clippy",
    "rust-analyzer.cargo.features": "all",
    "editor.formatOnSave": true,
    "rust-analyzer.rustfmt.extraArgs": ["+nightly"]
}
```

## Rust 编译模型

理解 Rust 如何编译有助于你有效地使用它。

<UniversalEditor compare={true} title="执行模型：Python vs Rust">
```python !! py
# Python: 解释型
# 源代码 → 字节码 (.pyc) → Python VM → 执行

def add(a, b):
    return a + b

# 逐行执行
# 类型错误发生在运行时
# 无编译步骤（技术上有字节码编译）
```

```rust !! rs
// Rust: 提前编译
// 源代码 → LLVM IR → 机器码 → 执行

fn add(a: i32, b: i32) -> i32 {
    a + b
}

// 执行前完全编译
// 编译时捕获类型错误
// 生成原生可执行文件
```
</UniversalEditor>

### 编译过程

1. **解析**: Rust 源代码 → AST（抽象语法树）
2. **HIR 降低**: AST → HIR（高级中间表示）
3. **MIR 降低**: HIR → MIR（中级中间表示）
4. **LLVM**: MIR → LLVM IR → 机器码
5. **链接**: 机器码 + 库 → 可执行文件

这就是为什么 `cargo build` 比 `python script.py` 花费更长时间，但生成的二进制文件运行速度快得多。

## 基本 Rust 语法（快速预览）

让我们看一下与 Python 对比的一些基本 Rust 语法：

### 变量

<UniversalEditor compare={true} title="变量：Python vs Rust">
```python !! py
# Python: 动态类型，默认可变
name = "Alice"       # string
age = 25             # int
height = 5.6         # float

# 可以重新赋值为不同类型
name = 42  # 这可以！

# 一切都可变
age = 26
```

```rust !! rs
// Rust: 静态类型，默认不可变
let name = "Alice";   // &str
let age: i32 = 25;    // i32（显式类型）
let height = 5.6;     // f64（推断）

// 不能重新赋值为不同类型
// name = 42;  // 错误：类型不匹配

// 变量默认不可变
// age = 26;  // 错误：不能赋值两次

// 使用 mut 表示可变变量
let mut age = 25;
age = 26;  // 可以
```
</UniversalEditor>

### 函数

<UniversalEditor compare={true} title="函数：Python vs Rust">
```python !! py
# Python: 动态类型，可选返回类型
def greet(name, age):
    message = f"Hello, {name}!"
    print(message)
    return age * 2

# 调用
result = greet("Alice", 25)
```

```rust !! rs
// Rust: 静态类型，显式返回类型
fn greet(name: &str, age: i32) -> i32 {
    let message = format!("Hello, {}!", name);
    println!("{}", message);
    age * 2  // 无分号 = 返回值
}

// 调用
let result = greet("Alice", 25);
```
</UniversalEditor>

## Rust 版本

Rust 有"版本"（editions），允许渐进式改进：

- **Rust 2015**: 原始版本
- **Rust 2018**: 重大改进（模块、异步准备）
- **Rust 2021**: 当前版本（默认）

新项目应该使用 Rust 2021。所有版本可以一起工作 - 你可以在 Rust 2021 项目中使用 Rust 2015 crate。

## Rust 社区

Rust 拥有最友好的编程社区之一：

### 官方资源
- **Rust 程序设计语言**: [doc.rust-lang.org/book](https://doc.rust-lang.org/book/) （"Rust 书"）
- **Rust by Example**: [doc.rust-lang.org/rust-by-example](https://doc.rust-lang.org/rust-by-example/)
- **Rust 标准库**: [doc.rust-lang.org/std](https://doc.rust-lang.org/std/)

### 社区资源
- **Rust 用户论坛**: [users.rust-lang.org](https://users.rust-lang.org/)
- **Rust Discord**: [discord.gg/rust-lang](https://discord.gg/rust-lang)
- **Reddit**: r/rust
- **Crates.io**: [crates.io](https://crates.io/)（包注册表）

## 常见的初次挑战

### 1. 借用检查器

你会经常遇到这个错误：
```rust
let s1 = String::from("hello");
let s2 = s1;
// println!("{}", s1);  // 错误：值移动后被借用
```

这是 Rust 的所有权系统防止移动后使用。我们将在模块 2 中详细讲解。

### 2. 冗长性

Rust 比 Python 更冗长：
```rust
// Rust: 到处都是显式类型
fn process(items: Vec<i32>) -> Vec<i32> {
    items.into_iter().map(|x| x * 2).collect()
}
```

这种冗长性换来的是安全性和性能。你会学会欣赏它。

### 3. 编译时间

Rust 编译比 Python 运行慢。提示：
- 使用 `cargo check` 进行快速验证
- 仅在需要时使用 `cargo build`
- 编译器正在捕获你在 Python 中运行时才会发现的错误

## 你的第二个 Rust 程序

让我们写一些更有趣的东西：

<UniversalEditor compare={true} title="斐波那契：Python vs Rust">
```python !! py
def fibonacci(n):
    """计算第 n 个斐波那契数。"""
    if n <= 1:
        return n
    a, b = 0, 1
    for _ in range(2, n + 1):
        a, b = b, a + b
    return b

if __name__ == "__main__":
    n = 10
    result = fibonacci(n)
    print(f"斐波那契({n}) = {result}")
```

```rust !! rs
fn fibonacci(n: u64) -> u64 {
    /// 计算第 n 个斐波那契数
    if n <= 1 {
        return n;
    }
    let (mut a, mut b) = (0, 1);
    for _ in 2..=n {
        let temp = a + b;
        a = b;
        b = temp;
    }
    b
}

fn main() {
    let n = 10;
    let result = fibonacci(n);
    println!("斐波那契({}) = {}", n, result);
}
```
</UniversalEditor>

在 `src/main.rs` 中创建此文件并使用 `cargo run` 运行。

## 测试你的安装

验证一切正常：

```bash
# 检查 Rust 版本
rustc --version

# 检查 Cargo
cargo --version

# 创建测试项目
cargo new test_project && cd test_project

# 构建它
cargo build

# 运行它
cargo run

# 运行测试
cargo test
```

如果所有命令都成功，你就准备好学习 Rust 了！

## 总结

在本模块中，你学习了：
- ✅ 为什么 Rust 对 Python 开发者有价值
- ✅ 如何安装 Rust 和 Cargo
- ✅ 如何创建和运行 Rust 项目
- ✅ 基本 Cargo 命令
- ✅ Python 解释和 Rust 编译的区别
- ✅ 如何设置开发环境

## 下一步

现在环境已设置好：
1. **[模块 1：语法基础](./module-01-syntax-basics)** - 通过与 Python 对比学习 Rust 语法
2. 用小程序练习
3. 探索 [Rust Playground](https://play.rust-lang.org/) 进行快速实验

## 练习

### 练习 1：创建项目

创建一个名为 `greeting` 的 Cargo 项目，要求：
- 询问用户的名字
- 打印个性化问候
- 使用变量和函数

### 练习 2：温度转换器

编写一个将华氏度转换为摄氏度的程序：
- 公式：`C = (F - 32) * 5/9`
- 为转换创建函数
- 用几个值测试

<details>
<summary>解决方案</summary>

```rust
fn fahrenheit_to_celsius(f: f64) -> f64 {
    (f - 32.0) * 5.0 / 9.0
}

fn main() {
    let fahrenheit = 98.6;
    let celsius = fahrenheit_to_celsius(fahrenheit);
    println!("{}°F = {}°C", fahrenheit, celsius);
}
```

</details>

---

**记住**：Rust 有学习曲线，但编译器是你的朋友。仔细阅读错误消息 - 它们非常有帮助！

**下一步**：[模块 1 - 语法基础](./module-01-syntax-basics) →
