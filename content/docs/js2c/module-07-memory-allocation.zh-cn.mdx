---
title: "åŠ¨æ€å†…å­˜åˆ†é…"
description: "ä» JavaScript è§†è§’å­¦ä¹  C è¯­è¨€åŠ¨æ€å†…å­˜åˆ†é…ï¼Œç†è§£ mallocã€freeã€å†…å­˜æ³„æ¼ï¼Œå¹¶å¯¹æ¯” JavaScript åƒåœ¾å›æ”¶æœºåˆ¶ã€‚"
---

# åŠ¨æ€å†…å­˜åˆ†é…

## 1. æ¦‚å¿µä»‹ç»

### ä» JavaScript åƒåœ¾å›æ”¶åˆ° C æ‰‹åŠ¨å†…å­˜ç®¡ç†

åœ¨ JavaScript ä¸­ï¼Œå†…å­˜ç®¡ç†æ˜¯è‡ªåŠ¨çš„ - åƒåœ¾å›æ”¶å™¨ä¼šè‡ªåŠ¨é‡Šæ”¾æœªä½¿ç”¨çš„å†…å­˜ã€‚è€Œåœ¨ C è¯­è¨€ä¸­ï¼Œä½ å¿…é¡»æ‰‹åŠ¨ä½¿ç”¨ `malloc()`ã€`calloc()`ã€`realloc()` å’Œ `free()` ç­‰å‡½æ•°æ¥åˆ†é…å’Œé‡Šæ”¾å†…å­˜ã€‚

> ğŸ’¡ **æ ¸å¿ƒæ¦‚å¿µ**ï¼šC çš„æ‰‹åŠ¨å†…å­˜ç®¡ç†ç»™ä½ ç²¾ç¡®çš„æ§åˆ¶æƒï¼Œä½†éœ€è¦ä»”ç»†æ³¨æ„ä»¥é˜²æ­¢å†…å­˜æ³„æ¼å’Œæœªå®šä¹‰è¡Œä¸ºã€‚

## 2. åŸºç¡€å†…å­˜åˆ†é…

<UniversalEditor title="åŸºç¡€å†…å­˜åˆ†é…" compare={true}>
```javascript !! js
// JavaScript - è‡ªåŠ¨å†…å­˜ç®¡ç†
let arr = [1, 2, 3, 4, 5];
arr.push(6); // æ•°ç»„è‡ªåŠ¨å¢é•¿
arr = null; // å†…å­˜å°†è¢«åƒåœ¾å›æ”¶

// åŠ¨æ€å¯¹è±¡åˆ›å»º
let obj = { name: "Alice", age: 30 };
obj = null; // å¯¹è±¡å°†è¢«åƒåœ¾å›æ”¶

// æ— éœ€æ‰‹åŠ¨å†…å­˜ç®¡ç†
```

```c !! c
#include <stdio.h>
#include <stdlib.h>

int main() {
    // ä¸ºæ•´æ•°åˆ†é…å†…å­˜
    int* ptr = (int*)malloc(sizeof(int));
    if (ptr == NULL) {
        printf("å†…å­˜åˆ†é…å¤±è´¥ï¼\n");
        return 1;
    }
    
    *ptr = 42;
    printf("å€¼: %d\n", *ptr);
    
    // å§‹ç»ˆé‡Šæ”¾åˆ†é…çš„å†…å­˜
    free(ptr);
    ptr = NULL; // è‰¯å¥½å®è·µï¼Œé¿å…æ‚¬ç©ºæŒ‡é’ˆ
    
    // ä¸ºæ•°ç»„åˆ†é…å†…å­˜
    int* arr = (int*)malloc(5 * sizeof(int));
    if (arr == NULL) {
        printf("æ•°ç»„åˆ†é…å¤±è´¥ï¼\n");
        return 1;
    }
    
    // åˆå§‹åŒ–æ•°ç»„
    for (int i = 0; i < 5; i++) {
        arr[i] = i + 1;
    }
    
    // ä½¿ç”¨æ•°ç»„
    for (int i = 0; i < 5; i++) {
        printf("%d ", arr[i]);
    }
    printf("\n");
    
    // é‡Šæ”¾æ•°ç»„å†…å­˜
    free(arr);
    arr = NULL;
    
    return 0;
}
```
</UniversalEditor>

## 3. é«˜çº§å†…å­˜å‡½æ•°

<UniversalEditor title="é«˜çº§å†…å­˜å‡½æ•°" compare={true}>
```javascript !! js
// JavaScript - åŠ¨æ€æ•°ç»„å’Œå¯¹è±¡
let numbers = [];
for (let i = 0; i < 10; i++) {
    numbers.push(i);
}

// æ•°ç»„è‡ªåŠ¨è°ƒæ•´å¤§å°
numbers.length = 20; // æ‰©å±•æ•°ç»„
numbers.length = 5;  // æˆªæ–­æ•°ç»„

// å¯¹è±¡å±æ€§å¯ä»¥åŠ¨æ€æ·»åŠ /åˆ é™¤
let person = {};
person.name = "Bob";
person.age = 25;
delete person.age;
```

```c !! c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

int main() {
    // calloc - åˆ†é…å¹¶åˆå§‹åŒ–ä¸ºé›¶
    int* zeros = (int*)calloc(5, sizeof(int));
    if (zeros == NULL) {
        printf("calloc å¤±è´¥ï¼\n");
        return 1;
    }
    
    printf("calloc åˆå§‹åŒ–çš„å€¼: ");
    for (int i = 0; i < 5; i++) {
        printf("%d ", zeros[i]); // å…¨ä¸ºé›¶
    }
    printf("\n");
    
    // realloc - è°ƒæ•´ç°æœ‰åˆ†é…çš„å¤§å°
    int* resized = (int*)realloc(zeros, 10 * sizeof(int));
    if (resized == NULL) {
        printf("realloc å¤±è´¥ï¼\n");
        free(zeros);
        return 1;
    }
    
    // åˆå§‹åŒ–æ–°å…ƒç´ 
    for (int i = 5; i < 10; i++) {
        resized[i] = i;
    }
    
    printf("realloc å: ");
    for (int i = 0; i < 10; i++) {
        printf("%d ", resized[i]);
    }
    printf("\n");
    
    free(resized);
    
    return 0;
}
```
</UniversalEditor>

## 4. å†…å­˜æ³„æ¼å’Œé¢„é˜²

<UniversalEditor title="å†…å­˜æ³„æ¼é¢„é˜²" compare={true}>
```javascript !! js
// JavaScript - è‡ªåŠ¨æ¸…ç†
function createObjects() {
    let obj = { data: "é‡è¦æ•°æ®" };
    // obj åœ¨å‡½æ•°ç»“æŸæ—¶å°†è¢«åƒåœ¾å›æ”¶
    // æ— éœ€æ‰‹åŠ¨æ¸…ç†
}

// å³ä½¿æœ‰å¾ªç¯å¼•ç”¨ï¼Œåƒåœ¾å›æ”¶å™¨ä¹Ÿèƒ½å¤„ç†
let obj1 = { name: "Alice" };
let obj2 = { name: "Bob" };
obj1.friend = obj2;
obj2.friend = obj1;
// å¾ªç¯å¼•ç”¨å°†è¢«æ£€æµ‹å¹¶æ¸…ç†
```

```c !! c
#include <stdio.h>
#include <stdlib.h>

// é”™è¯¯ï¼šå†…å­˜æ³„æ¼ - åˆ†é…çš„å†…å­˜æœªé‡Šæ”¾
void badFunction() {
    int* ptr = (int*)malloc(sizeof(int));
    *ptr = 42;
    // å†…å­˜æ³„æ¼ï¼šptr æœªé‡Šæ”¾ï¼
    // ptr è¶…å‡ºä½œç”¨åŸŸï¼Œå†…å­˜ä¸¢å¤±
}

// æ­£ç¡®ï¼šé€‚å½“çš„å†…å­˜ç®¡ç†
void goodFunction() {
    int* ptr = (int*)malloc(sizeof(int));
    if (ptr == NULL) {
        return; // å¤„ç†åˆ†é…å¤±è´¥
    }
    
    *ptr = 42;
    printf("å€¼: %d\n", *ptr);
    
    free(ptr); // å§‹ç»ˆé‡Šæ”¾åˆ†é…çš„å†…å­˜
    ptr = NULL; // é˜²æ­¢æ‚¬ç©ºæŒ‡é’ˆ
}

// å†…å­˜æ³„æ¼æ£€æµ‹æ¨¡å¼
void safeAllocation() {
    int* ptr = NULL;
    
    ptr = (int*)malloc(sizeof(int));
    if (ptr == NULL) {
        printf("åˆ†é…å¤±è´¥\n");
        return;
    }
    
    // ä½¿ç”¨å†…å­˜
    *ptr = 100;
    
    // æ¸…ç†
    free(ptr);
    ptr = NULL;
}

int main() {
    goodFunction();
    safeAllocation();
    return 0;
}
```
</UniversalEditor>

## 5. å¸¸è§é™·é˜±
- **å†…å­˜æ³„æ¼**ï¼šå¿˜è®°è°ƒç”¨ `free()`
- **é‡å¤é‡Šæ”¾**ï¼šå¯¹å·²é‡Šæ”¾çš„å†…å­˜å†æ¬¡è°ƒç”¨ `free()`
- **æ‚¬ç©ºæŒ‡é’ˆ**ï¼šé‡Šæ”¾å†…å­˜åä»ä½¿ç”¨æŒ‡é’ˆ
- **ç¼“å†²åŒºæº¢å‡º**ï¼šå†™å…¥è¶…å‡ºåˆ†é…å†…å­˜çš„èŒƒå›´
- **ç©ºæŒ‡é’ˆè§£å¼•ç”¨**ï¼šæœªæ£€æŸ¥ `malloc()` æ˜¯å¦è¿”å› NULL

## 6. ç»ƒä¹ é¢˜
1. ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œä¸ºå­—ç¬¦ä¸²åˆ†é…å†…å­˜ï¼Œå¤åˆ¶ç»™å®šå­—ç¬¦ä¸²åˆ°å…¶ä¸­ï¼Œå¹¶è¿”å›æŒ‡é’ˆã€‚è®°å¾—ç¨åé‡Šæ”¾å®ƒã€‚
2. åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼ŒåŠ¨æ€åˆ†é…äºŒç»´æ•°ç»„å¹¶ç”¨å€¼åˆå§‹åŒ–å®ƒã€‚
3. ç¼–å†™ä¸€ä¸ªç¨‹åºï¼Œé€šè¿‡è·Ÿè¸ªåˆ†é…å’Œé‡Šæ”¾æ¥æ¼”ç¤ºå†…å­˜æ³„æ¼æ£€æµ‹ã€‚

## 7. æ€§èƒ½åˆ†æ
- æ‰‹åŠ¨å†…å­˜ç®¡ç†å¯èƒ½æ¯”åƒåœ¾å›æ”¶æ›´é«˜æ•ˆ
- é¢‘ç¹çš„åˆ†é…/é‡Šæ”¾å¯èƒ½å¯¼è‡´å†…å­˜ç¢ç‰‡
- å†…å­˜æ± å¯ä»¥æé«˜å°è§„æ¨¡é¢‘ç¹åˆ†é…çš„æ€§èƒ½
- é€‚å½“çš„å†…å­˜ç®¡ç†å¯¹é•¿æ—¶é—´è¿è¡Œçš„åº”ç”¨ç¨‹åºè‡³å…³é‡è¦

---

> **å°ç»“**ï¼šC çš„æ‰‹åŠ¨å†…å­˜ç®¡ç†æä¾›æ§åˆ¶å’Œæ€§èƒ½ï¼Œä½†éœ€è¦çºªå¾‹æ€§ã€‚å§‹ç»ˆå°† `malloc()` ä¸ `free()` é…å¯¹ï¼Œæ£€æŸ¥åˆ†é…å¤±è´¥ï¼Œå¹¶ä½¿ç”¨ Valgrind ç­‰å·¥å…·æ£€æµ‹å†…å­˜æ³„æ¼ã€‚ 